---
reviewers:
- Random-Liu
title: اعتبارسنجی تنظیمات نود
weight: 30
---

## تست انطباق نود

*تست انطباق نود* یک چارچوب تست کانتینری است که برای تأیید سیستم و تست عملکرد نود استفاده می‌شود. این تست اعتبارسنجی می‌کند که آیا نود حداقل نیازهای Kubernetes را برآورده می‌کند یا خیر؛ نودی که این تست را پاس کند، صلاحیت پیوستن به یک کلاستر Kubernetes را دارد.

## پیش‌نیازهای نود

برای اجرای تست انطباق نود، نود باید همان پیش‌نیازهای یک نود استاندارد Kubernetes را برآورده کند. حداقل، نود باید شامل دیمون‌های زیر باشد:

* ران‌تایم‌های کانتینری سازگار با CRI مانند Docker، Containerd و CRI-O
* Kubelet

## اجرای تست انطباق نود

برای اجرای تست انطباق نود، مراحل زیر را انجام دهید:
1. مقدار گزینه `--kubeconfig` برای kubelet را محاسبه کنید؛ به عنوان مثال:
   `--kubeconfig=/var/lib/kubelet/config.yaml`.
   چون چارچوب تست یک صفحه کنترل محلی را برای تست kubelet راه‌اندازی می‌کند،
   از `http://localhost:8080` به عنوان URL سرور API استفاده کنید.
   برخی از پارامترهای خط فرمان kubelet دیگر که ممکن است بخواهید استفاده کنید عبارتند از:
  * `--cloud-provider`: اگر از `--cloud-provider=gce` استفاده می‌کنید، باید این پرچم را برای اجرای تست حذف کنید.

2. تست انطباق نود را با دستور زیر اجرا کنید:

```shell
# $CONFIG_DIR مسیر پاد مانیفست kubelet شماست.
# $LOG_DIR مسیر خروجی تست است.
sudo docker run -it --rm --privileged --net=host \
  -v /:/rootfs -v $CONFIG_DIR:$CONFIG_DIR -v $LOG_DIR:/var/result \
  registry.k8s.io/node-test:0.2
```

## اجرای تست انطباق نود برای سایر معماری‌ها

Kubernetes همچنین تصاویر داکر تست انطباق نود برای سایر معماری‌ها را فراهم می‌کند:

| معماری  |       تصویر       |
|---------|:-----------------:|
| amd64   |  node-test-amd64  |
| arm     |    node-test-arm  |
| arm64   |  node-test-arm64  |

## اجرای تست‌های انتخابی

برای اجرای تست‌های خاص، متغیر محیطی `FOCUS` را با عبارت منظم تست‌هایی که می‌خواهید اجرا کنید بازنویسی کنید.

```shell
sudo docker run -it --rm --privileged --net=host \
  -v /:/rootfs:ro -v $CONFIG_DIR:$CONFIG_DIR -v $LOG_DIR:/var/result \
  -e FOCUS=MirrorPod \ # فقط تست MirrorPod را اجرا کن
  registry.k8s.io/node-test:0.2
```

برای رد کردن تست‌های خاص، متغیر محیطی `SKIP` را با عبارت منظم تست‌هایی که می‌خواهید رد کنید بازنویسی کنید.

```shell
sudo docker run -it --rm --privileged --net=host \
  -v /:/rootfs:ro -v $CONFIG_DIR:$CONFIG_DIR -v $LOG_DIR:/var/result \
  -e SKIP=MirrorPod \ # همه تست‌های انطباق را اجرا کن ولی تست MirrorPod را رد کن
  registry.k8s.io/node-test:0.2
```

تست انطباق نود نسخه کانتینری از [تست e2e نود](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/e2e-node-tests.md) است. به طور پیش‌فرض، همه تست‌های انطباق را اجرا می‌کند.

به طور نظری، می‌توانید هر تست e2e نود را اجرا کنید اگر کانتینر را پیکربندی کرده و ولوم‌های مورد نیاز را به درستی مانت کنید. اما **به شدت توصیه می‌شود که فقط تست انطباق را اجرا کنید**، زیرا پیکربندی برای اجرای تست غیر انطباق بسیار پیچیده‌تر است.

## هشدارها

* تست برخی از تصاویر داکر را روی نود باقی می‌گذارد، از جمله تصویر تست انطباق نود و تصاویر کانتینرهایی که در تست عملکرد استفاده می‌شوند.
* تست کانتینرهای مرده را روی نود باقی می‌گذارد. این کانتینرها در طول تست عملکرد ایجاد می‌شوند.
