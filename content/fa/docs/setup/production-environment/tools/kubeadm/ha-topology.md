---
reviewers:
- sig-cluster-lifecycle
title: گزینه‌های توپولوژی با قابلیت Highly Available
content_type: concept
weight: 50
---

<!-- overview -->

این صفحه دو گزینه برای پیکربندی توپولوژی خوشه‌های Kubernetes با قابلیت Highly Available (HA) را توضیح می‌دهد.

شما می‌توانید یک خوشه HA را به دو صورت پیکربندی کنید:

- با نودهای کنترلی پشته‌ای، جایی که نودهای etcd هم‌مکان با نودهای کنترلی قرار دارند
- با نودهای جداگانه etcd، جایی که etcd بر روی نودهای جداگانه از نودهای کنترلی اجرا می‌شود

قبل از راه‌اندازی یک خوشه HA، باید مزایا و معایب هر توپولوژی را با دقت مورد بررسی قرار دهید.

{{< note >}}
kubeadm خوشه etcd را به صورت استاتیک bootstrap می‌کند. برای اطلاعات بیشتر، [راهنمای خوشه‌بندی etcd](https://github.com/etcd-io/etcd/blob/release-3.4/Documentation/op-guide/clustering.md#static) را مطالعه کنید.
{{< /note >}}



<!-- body -->

## توپولوژی etcd پشته‌ای

یک خوشه HA پشته‌ای یک [توپولوژی](https://en.wikipedia.org/wiki/Network_topology) است که خوشه ذخیره داده توزیع‌شده‌ای که توسط etcd فراهم می‌شود، بر روی خوشه‌ای که توسط نودهای مدیریت شده توسط kubeadm اجرا می‌شود، ستاپل است.

هر نود کنترلی شامل یک نمونه از `kube-apiserver`، `kube-scheduler` و `kube-controller-manager` است. `kube-apiserver` به نودهای کارگر با استفاده از یک توزیع‌کننده بار (load balancer) ارائه می‌شود.

هر نود کنترلی یک عضو etcd محلی ایجاد می‌کند و این عضو etcd فقط با `kube-apiserver` این نود ارتباط برقرار می‌کند. همین مورد برای نمونه‌های محلی `kube-controller-manager` و `kube-scheduler` نیز صدق می‌کند.

این توپولوژی نقطه‌های کنترل و اعضای etcd را بر روی همان نودها جفت می‌کند. نسبت به یک خوشه با نودهای etcd خارجی، ساده‌تر برای راه‌اندازی و مدیریت تکثیر است.

با این حال، یک خوشه پشته‌ای با خطر جفت‌شدن ناکام مواجه است. اگر یک نود خراب شود، هم عضو etcd و هم یک نمونه از نود کنترلی از بین می‌روند و تکثیری تخریب می‌شود. شما می‌توانید این خطر را با اضافه کردن نودهای بیشتری از نودهای کنترلی کاهش دهید.

بنابراین، برای یک خوشه HA حداقل سه نود کنترلی پشته‌ای را اجرا کنید.

این توپولوژی پیش‌فرض در kubeadm است. یک عضو etcd محلی به صورت خودکار در نودهای کنترلی ایجاد می‌شود هنگام استفاده از `kubeadm init` و `kubeadm join --control-plane`.

![توپولوژی etcd پشته‌ای](/images/kubeadm/kubeadm-ha-topology-stacked-etcd.svg)

## توپولوژی etcd خارجی

یک خوشه HA با etcd خارجی یک [توپولوژی](https://en.wikipedia.org/wiki/Network_topology) است که خوشه ذخیره داده توزیع‌شده‌ای که توسط etcd فراهم می‌شود، خارج از خوشه‌ای که توسط نودهایی که اجرا می‌شوند، اجرا می‌شود.

مانند توپولوژی etcd پشته‌ای، هر نود کنترلی در توپولوژی etcd خارجی یک نمونه از `kube-apiserver`، `kube-scheduler` و `kube-controller-manager` اجرا می‌کند. و `kube-apiserver` به نودهای کارگر با استفاده از یک توزیع‌کننده بار (load balancer) ارائه می‌شود. با این حال، اعضای etcd بر روی میزبان‌های جداگانه اجرا می‌شوند و هر میزبان etcd با `kube-apiserver` هر نود کنترلی ارتباط برقرار می‌کند.

این توپولوژی کنترل و عضو etcd را جدا می‌کند. بنابراین، یک تنظیم HA ارائه می‌دهد که از دست دادن یک نمونه کنترل یا یک عضو etcd کمترین تأثیر را دارد و بر تکرار خوشه تأثیر ندارد مانند توپولوژی HA پشته‌ای.

با این حال، این توپولوژی نیازمند ضعف دو برابر تعداد میزبان‌ها نسبت به توپولوژی HA پشته‌ای است. حداقل سه میزبان برای نودهای کنترلی و سه میزبان برای نودهای etcd برای یک خوشه HA با این توپولوژی لازم است.

![توپولوژی etcd خارجی](/images/kubeadm/kubeadm-ha-topology-external-etcd.svg)



## {{% heading "چه کاری بعدا" %}}


- [راه‌اندازی یک خوشه با قابلیت Highly Available با kubeadm](/docs/setup/production-environment/tools/kubeadm/high-availability/)
