---
reviewers:
- bprashanth
- erictune
- foxish
- smarterclayton
title: حذف اجباری پادهای StatefulSet
content_type: task
weight: 70
---

<!-- overview -->
این صفحه نشان می‌دهد که چگونه پادهایی که بخشی از یک
{{< glossary_tooltip text="StatefulSet" term_id="StatefulSet" >}} هستند را حذف کنید و ملاحظاتی که باید در این کار مد نظر داشته باشید.

## {{% heading "prerequisites" %}}

- این تسک نسبتاً پیشرفته است و می‌تواند برخی از خصوصیات ذاتی StatefulSet را نقض کند.
- قبل از ادامه، با ملاحظات ذکر شده در زیر آشنا شوید.

<!-- steps -->

## ملاحظات StatefulSet

در عملکرد عادی یک StatefulSet، **هرگز** نیازی به حذف اجباری یک پاد StatefulSet نیست.
[کنترلر StatefulSet](/docs/concepts/workloads/controllers/statefulset/) مسئول
ایجاد، مقیاس‌بندی و حذف اعضای StatefulSet است. این کنترلر سعی می‌کند اطمینان حاصل کند که تعداد مشخصی از پادها از شماره صفر تا N-1 زنده و آماده هستند. StatefulSet اطمینان می‌دهد که در هر زمان، حداکثر یک پاد با یک هویت معین در کلاستر در حال اجرا باشد. این به عنوان ویژگی *حداکثر یکی* در StatefulSet شناخته می‌شود.

حذف دستی اجباری باید با احتیاط انجام شود، زیرا پتانسیل نقض ویژگی حداکثر یکی را دارد که ذاتاً در StatefulSet وجود دارد. StatefulSet ها ممکن است برای اجرای برنامه‌های توزیع شده و کلاستر شده استفاده شوند که نیاز به هویت شبکه پایدار و ذخیره‌سازی پایدار دارند. این برنامه‌ها اغلب دارای پیکربندی‌هایی هستند که به یک گروه ثابت از اعضا با هویت‌های ثابت وابسته‌اند. داشتن چندین عضو با همان هویت می‌تواند فاجعه‌آمیز باشد و ممکن است منجر به از دست رفتن داده‌ها شود (مثلاً سناریوی split brain در سیستم‌های مبتنی بر کواروم).

## حذف پادها

می‌توانید یک حذف آرام پاد را با فرمان زیر انجام دهید:

```shell
kubectl delete pods <pod>
```

برای اینکه حذف آرام به پایان برسد، پاد **نباید** دارای `pod.Spec.TerminationGracePeriodSeconds` برابر با 0 باشد. عمل تنظیم `pod.Spec.TerminationGracePeriodSeconds` به 0 ثانیه ناامن است و به شدت برای پادهای StatefulSet توصیه نمی‌شود. حذف آرام امن است و اطمینان حاصل می‌کند که پاد [به طور آرام خاموش می‌شود](/docs/concepts/workloads/pods/pod-lifecycle/#pod-termination) قبل از اینکه kubelet نام آن را از apiserver حذف کند.

یک پاد به صورت خودکار حذف نمی‌شود زمانی که یک نود غیرقابل دسترس باشد.
پادهای در حال اجرا روی یک نود غیرقابل دسترس به حالت 'Terminating' یا 'Unknown' وارد می‌شوند بعد از یک
[timeout](/docs/concepts/architecture/nodes/#condition).
پادها همچنین ممکن است به این حالات وارد شوند زمانی که کاربر تلاش به حذف آرام یک پاد
روی یک نود غیرقابل دسترس کند.
تنها راه‌هایی که یک پاد در چنین حالتی می‌تواند از apiserver حذف شود به شرح زیر است:

- شیء نود حذف شود (توسط شما، یا توسط
  [کنترلر نود](/docs/concepts/architecture/nodes/#node-controller)).
- kubelet روی نود غیرپاسخگو شروع به پاسخ‌دهی کند، پاد را بکشد و مدخل را از apiserver حذف کند.
- حذف اجباری پاد توسط کاربر.

بهترین روش توصیه شده این است که از روش اول یا دوم استفاده کنید. اگر تأیید شد که یک نود مرده است (مثلاً به طور دائم از شبکه جدا شده، خاموش شده و غیره)، سپس شیء نود را حذف کنید. اگر نود از یک پارتیشن شبکه رنج می‌برد، سعی کنید این مشکل را حل کنید یا منتظر بمانید تا حل شود. وقتی پارتیشن بهبود یافت، kubelet حذف پاد را کامل خواهد کرد و نام آن را در apiserver آزاد خواهد کرد.

معمولاً، سیستم حذف را زمانی که پاد دیگر روی نود در حال اجرا نیست یا
نود توسط یک مدیر حذف شده است، تکمیل می‌کند. می‌توانید این را با حذف اجباری پاد لغو کنید.

### حذف اجباری

حذف اجباری **منتظر تأیید از kubelet که پاد خاتمه یافته است، نمی‌ماند.
صرف‌نظر از اینکه حذف اجباری موفق به کشتن پاد می‌شود یا نه، بلافاصله نام را از apiserver آزاد می‌کند. این اجازه می‌دهد کنترلر StatefulSet یک پاد جایگزین با همان هویت ایجاد کند؛ این می‌تواند منجر به تکثیر یک پاد همچنان در حال اجرا شود، و اگر پاد مذکور هنوز بتواند با دیگر اعضای StatefulSet ارتباط برقرار کند،
ویژگی حداکثر یکی را که StatefulSet برای تضمین طراحی شده است نقض کند.

وقتی شما یک پاد StatefulSet را اجباری حذف می‌کنید، در حال اعلام این هستید که پاد مورد نظر دیگر هرگز
با سایر پادهای StatefulSet تماس نخواهد داشت و نام آن می‌تواند با اطمینان برای ایجاد یک جایگزین آزاد شود.

اگر می‌خواهید یک پاد را با استفاده از kubectl نسخه >= 1.5 به طور اجباری حذف کنید، به صورت زیر عمل کنید:

```shell
kubectl delete pods <pod> --grace-period=0 --force
```

اگر از هر نسخه kubectl <= 1.4 استفاده می‌کنید، باید گزینه `--force` را حذف کرده و از این استفاده کنید:

```shell
kubectl delete pods <pod> --grace-period=0
```

اگر حتی پس از این دستورات پاد در حالت `Unknown` گیر کرده است، از دستور زیر برای
حذف پاد از کلاستر استفاده کنید:

```shell
kubectl patch pod <pod> -p '{"metadata":{"finalizers":null}}'
```

همیشه حذف اجباری پادهای StatefulSet را با دقت و با آگاهی کامل از ریسک‌های موجود انجام دهید.

## {{% heading "whatsnext" %}}

بیشتر درباره [دیباگ یک StatefulSet](/docs/tasks/debug/debug-application/debug-statefulset/) بیاموزید.
