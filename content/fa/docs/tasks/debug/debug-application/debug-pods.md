---
reviewers:
- mikedanese
- thockin
title: رفع اشکال پادها
content_type: task
weight: 10
---

<!-- overview -->

این راهنما برای کمک به کاربران در اشکال‌زدایی برنامه‌هایی است که در Kubernetes
مستقر شده‌اند و به درستی عمل نمی‌کنند. این راهنما برای افرادی نیست که می‌خواهند خوشه خود را اشکال‌زدایی کنند.
برای این کار باید به [این راهنما](/docs/tasks/debug/debug-cluster) مراجعه کنید.

<!-- body -->

## تشخیص مشکل

گام اول در اشکال‌زدایی، تریاژ است. مشکل چیست؟ آیا مشکل از پادها، کنترل‌کننده‌های تکثیر یا سرویس‌های شماست؟

   * [اشکال‌زدایی پادها](#debugging-pods)
   * [اشکال‌زدایی کنترل‌کننده‌های تکثیر](#debugging-replication-controllers)
   * [اشکال‌زدایی سرویس‌ها](#debugging-services)

### اشکال‌زدایی پادها

گام اول در اشکال‌زدایی یک پاد، نگاهی به آن است. وضعیت کنونی پاد و رویدادهای اخیر را با دستور زیر بررسی کنید:

```shell
kubectl describe pods ${POD_NAME}
```

وضعیت کانتینرها در پاد را بررسی کنید. آیا همه آنها `Running` هستند؟ آیا تازه‌ترین راه‌اندازی‌ها را داشته‌اند؟

بسته به وضعیت پاد، ادامه دهید.

#### پاد من در وضعیت Pending است

اگر یک پاد در وضعیت `Pending` گیر کرده است، به این معنی است که نمی‌توان آن را بر روی یک نود زمینه‌ای زمانبندی کرد.
معمولاً این به دلیل منابع کافی یا ناکافی از نوعی است که از برنامه‌ریزی جلوگیری می‌کند. به خروجی دستور `kubectl describe ...` بالا نگاه کنید.
باید پیام‌هایی از برنامه‌ریز درباره اینکه چرا نمی‌توان پاد شما را زمانبندی کرد، وجود داشته باشد.
دلایل شامل:

* **شما از منابع کافی برخوردار نیستید**: ممکن است منابع CPU یا حافظه خود را در خوشه خود به پایان رسانده باشید، در این صورت باید پادها را حذف کنید، درخواست‌های منابع را تنظیم کنید یا نودهای جدیدی به خوشه خود اضافه کنید. برای اطلاعات بیشتر به [سند منابع محاسباتی](/docs/concepts/configuration/manage-resources-containers/) مراجعه کنید.

* **شما از `hostPort` استفاده می‌کنید**: وقتی یک پاد را به `hostPort` متصل می‌کنید، تعداد محدودی از مکان‌ها وجود دارد که می‌توان این پاد را زمانبندی کرد. در اکثر موارد، استفاده از `hostPort` غیر ضروری است، سعی کنید از یک شیء سرویس برای بیرون‌ریزی پاد خود استفاده کنید. اگر واقعاً به `hostPort` نیاز دارید، می‌توانید تنها تعدادی از پادها را زمانبندی کنید که تعداد آنها مساوی تعداد نودهای خوشه Kubernetes شما باشد.


#### پاد من در وضعیت Waiting است

اگر یک پاد در وضعیت `Waiting` گیر کرده است، به این معنی است که به یک نود کارگر زمانبندی شده است، اما نمی‌تواند بر روی آن ماشین اجرا شود.
در دوش راه‌های اجرای دستور `kubectl describe ...` باید اطلاعات کافی باشد. شایع‌ترین علت پادهای `Waiting`، شکست در بارگیری تصویر است.
سه چیز را بررسی کنید:

* مطمئن شوید که نام تصویر را درست وارد کرده‌اید.
* آیا تصویر را به رجیستری push کرده‌اید؟
* سعی کنید تصویر را به صورت دستی بکشید و ببینید آیا تصویر قابل بارگیری است. به عنوان مثال، اگر از Docker در کامپیوتر خود استفاده می‌کنید، دستور `docker pull <image>` را اجرا کنید.


#### پاد من در وضعیت Terminating است

اگر یک پاد در وضعیت `Terminating` گیر کرده است، به این معنی است که حذف آن برای پاد صادر شده است، اما پایانه کنترل نمی‌تواند شیء پاد را حذف کند.

این معمولاً در صورتی اتفاق می‌افتد که پاد دارای [پایان‌دهنده](/docs/concepts/overview/working-with-objects/finalizers/) است و یک [وب‌هوک تأییدی](/docs/reference/access-authn-authz/extensible-admission-controllers/) در خوشه نصب شده است که جلوگیری می‌کند پایانه کنترل از حذف پایانه نهایی کند.

برای شناسایی این سناریو، بررسی کنید که آیا خوشه شما دارای هرگونه `ValidatingWebhookConfiguration` یا `MutatingWebhookConfiguration` است که به عملیات `UPDATE` برای منابع `pods` هدف داشته باشد.

اگر وب‌هوک توسط یک شخص ثالث فراهم شده است:
- مطمئن شوید از آخرین نسخه استفاده می‌کنید.
-

 وب‌هوک را برای عملیات `UPDATE` غیرفعال کنید.
- یک مشکل با ارائه دهنده مربوطه گزارش دهید.

اگر شما نویسنده وب‌هوک هستید:
- برای یک وب‌هوک تغییردهنده، مطمئن شوید هرگز فیلدهای ثابت را در عملیات `UPDATE` تغییر نمی‌دهید. به عنوان مثال، تغییرات در کانتینرها معمولاً مجاز نیست.
- برای یک وب‌هوک اعتبارسنجی، مطمئن شوید که سیاست‌های اعتبارسنجی خود را فقط بر روی تغییرات جدید اعمال می‌کنید. به عبارت دیگر، باید اجازه دهید پادهایی که قبل از نصب وب‌هوک اعتبارسنجی ایجاد شده‌اند، ادامه داشته باشند.

#### پاد من دارای خطا یا سلامتی ناقص است

هنگامی که پاد شما زمانبندی شده است، روش‌هایی که در [اشکال‌زدایی پادهای در حال اجرا](/docs/tasks/debug/debug-application/debug-running-pod/) توضیح داده شده است، برای اشکال‌زدایی در دسترس هستند.

#### پاد من در حال اجراست اما کاری که به آن گفته‌ام انجام نمی‌دهد

اگر پاد شما همانطور که انتظار داشتید عمل نمی‌کند، ممکن است در توضیحات پاد شما (به عنوان مثال فایل `mypod.yaml` روی کامپیوتر محلی شما) خطایی وجود داشته باشد و این خطا وقتی که پاد ایجاد شد به طور خود سرکوب شد. اغلب بخشی از توضیحات پاد به طور نادرست جا به جا شده‌اند یا نام کلیدی به اشتباه تایپ شده‌اند، و بنابراین کلید استفاده نمی‌شود. به عنوان مثال، اگر `command` را به عنوان `commnd` اشتباه املاء کردید، پاد ایجاد می‌شود اما خط اواخر آن را استفاده نمی‌کند.

اولین کاری که باید انجام دهید، حذف پاد خود و سعی در ایجاد دوباره آن با گزینه `--validate` است. به عنوان مثال، دستور `kubectl apply --validate -f mypod.yaml` را اجرا کنید. اگر `command` را به عنوان `commnd` اشتباه املاء کردید، خطایی شبیه به این خواهید دید:

```shell
I0805 10:43:25.129850   46757 schema.go:126] unknown field: commnd
I0805 10:43:25.129973   46757 schema.go:129] this may be a false alarm, see https://github.com/kubernetes/kubernetes/issues/6842
pods/mypod
```

بعد از آن، چیز بعدی که باید بررسی کنید این است که آیا پاد در apiserver با پادی که قصد ایجاد آن را داشتید (به عنوان مثال، در یک پرونده yaml بر روی کامپیوتر محلی شما) همخوانی دارد. به عنوان مثال، دستور `kubectl get pods/mypod -o yaml > mypod-on-apiserver.yaml` را اجرا کنید و سپس توصیف اصلی پاد، `mypod.yaml` را با آنی که از apiserver دریافت کردید، `mypod-on-apiserver.yaml`، مقایسه کنید. به طور معمول، برخی از خطوط در نسخه "apiserver" وجود خواهد داشت که در نسخه اصلی وجود ندارد. این امر مورد انتظار است. با این حال، اگر خطوط در نسخه اصلی وجود داشته باشد که در نسخه "apiserver" وجود نداشته باشد، این ممکن است نشانه مشکل با مشخصات پاد شما باشد.

### اشکال‌زدایی کنترل‌کننده‌های تکثیر

کنترل‌کننده‌های تکثیر به طور معمول ساده هستند. آنها می‌توانند یا پادها را ایجاد کنند یا نتوانند. اگر نتوانند پادها را ایجاد کنند، لطفاً به [دستورالعمل‌های بالا](#debugging-pods) مراجعه کنید تا پادهای خود را اشکال‌زدایی کنید.

همچنین می‌توانید از `kubectl describe rc ${CONTROLLER_NAME}` برای بررسی رویدادهای مربوط به کنترل‌کننده‌های تکثیر استفاده کنید.

### اشکال‌زدایی سرویس‌ها

سرویس‌ها برای توزیع بار در یک مجموعه از پادها فراهم می‌کنند. چندین مشکل متداول وجود دارد که ممکن است باعث عدم کارآیی سرویس‌ها شود. دستورالعمل‌های زیر باید به اشکال‌زدایی مشکلات سرویس کمک کند.

ابتدا، تأیید کنید که برای سرویس، نقاط پایانی وجود دارد. برای هر شیء سرویس، apiserver یک منبع `endpoints` را موجود می‌سازد.

می‌توانید این منبع را با دستور زیر مشاهده کنید:

```shell
kubectl get endpoints ${SERVICE_NAME}
```

مطمئن شوید که نقاط پایانی با تعداد پادهایی که انتظار دارید عضو سرویس شما باشند.
به عنوان مثال، اگر سرویس شما برای یک کانتینر nginx با 3 نسخه ایجاد شده است، انتظار می‌رود در پ

ایانهای سرویس سه آدرس IP مختلف را مشاهده کنید.

#### سرویس من بدون نقاط پایانی است

اگر شما دچار مشکل نقاط پایانی شده‌اید، سعی کنید پادها را با استفاده از برچسب‌هایی که سرویس استفاده می‌کند لیست کنید.
تصور کنید که یک سرویس دارید که برچسب‌های زیر را دارد:

```yaml
...
spec:
  - selector:
     name: nginx
     type: frontend
```

می‌توانید استفاده کنید:

```shell
kubectl get pods --selector=name=nginx,type=frontend
```

برای فهرست پادهایی که با این انتخابگر مطابقت دارند. تأیید کنید که لیست با پادهایی که انتظار دارید برای ارائه سرویس شما هستند. مطمئن شوید که `containerPort` پاد با `targetPort` سرویس همخوانی دارد

#### ترافیک شبکه به جلو نمی‌روید

لطفاً برای اطلاعات بیشتر به [اشکال‌زدایی سرویس](/docs/tasks/debug/debug-application/debug-service/) مراجعه کنید.

## {{% heading "whatsnext" %}}

اگر هیچ‌کدام از موارد فوق مشکل شما را حل نکرد، دستورالعمل‌های [سند اشکال‌زدایی سرویس](/docs/tasks/debug/debug-application/debug-service/) را دنبال کنید تا مطمئن شوید که سرویس شما در حال اجرا است، دارای `Endpoints` است و پادهای شما به واقعیت خدمت می‌کنند؛ DNS شما کار می‌کند، قوانین iptables نصب شده‌اند، و kube-proxy به نظر می‌رسد که نادرست عمل نمی‌کند.

شما همچنین می‌توانید به [سند اشکال‌زدایی](/docs/tasks/debug/) برای اطلاعات بیشتر مراجعه کنید.
