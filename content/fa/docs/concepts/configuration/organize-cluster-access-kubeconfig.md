---
title: سازماندهی دسترسی به خوشه‌ها با استفاده از فایل‌های kubeconfig
content_type: concept
weight: 60
---

<!-- overview -->

استفاده از فایل‌های kubeconfig برای سازماندهی اطلاعات درباره خوشه‌ها، کاربران، فضاهای نام و مکانیزم‌های احراز هویت است. ابزار خط فرمان `kubectl` از فایل‌های kubeconfig برای یافتن اطلاعاتی که برای انتخاب یک خوشه و ارتباط با سرور API خوشه نیاز دارد، استفاده می‌کند.

{{< note >}}
یک فایل که برای پیکربندی دسترسی به خوشه‌ها استفاده می‌شود، *فایل kubeconfig* نامیده می‌شود. این یک روش عمومی برای ارجاع به فایل‌های پیکربندی است و به این معنی نیست که یک فایل با نام `kubeconfig` وجود دارد.
{{< /note >}}

{{< warning >}}
فقط از فایل‌های kubeconfig از منابع قابل اعتماد استفاده کنید. استفاده از یک فایل kubeconfig با نظرات ویژه ممکن است منجر به اجرای کد خبیث یا افشای فایل شود. در صورت استفاده از یک فایل kubeconfig غیرقابل اعتماد، آن را با دقت بررسی کنید، تا به همان اندازه که یک اسکریپت شل را بررسی می‌کنید.
{{< /warning>}}

به طور پیش‌فرض، `kubectl` به دنبال یک فایل با نام `config` در دایرکتوری `$HOME/.kube` می‌گردد. می‌توانید فایل‌های kubeconfig دیگری را با تنظیم متغیر محیطی `KUBECONFIG` یا با تنظیم پرچم [`--kubeconfig`](/docs/reference/generated/kubectl/kubectl/) مشخص کنید.

برای دستورات مرحله به مرحله برای ایجاد و مشخص کردن فایل‌های kubeconfig، به [پیکربندی دسترسی به چند خوشه](/docs/tasks/access-application-cluster/configure-access-multiple-clusters) مراجعه کنید.


<!-- body -->

## پشتیبانی از چند خوشه، کاربر و مکانیزم احراز هویت

فرض کنید چندین خوشه دارید و کاربران و مؤلفه‌های شما با روش‌های مختلف احراز هویت می‌کنند. به عنوان مثال:

- یک kubelet در حال اجرا ممکن است با استفاده از گواهی نامه‌ها احراز هویت کند.
- یک کاربر ممکن است با استفاده از توکن‌ها احراز هویت کند.
- مدیران ممکن است دسته‌های گواهی نامه‌ها داشته باشند که به کاربران فردی ارائه می‌دهند.

با فایل‌های kubeconfig، می‌توانید خوشه‌ها، کاربران و فضاهای نام خود را سازماندهی کنید. همچنین می‌توانید contextها را تعریف کنید تا به راحتی بین خوشه‌ها و فضاهای نام جابه‌جا شوید.

## Context

یک عنصر *context* در یک فایل kubeconfig برای گروه بندی پارامترهای دسترسی زیر یک نام مناسب استفاده می‌شود. هر context شامل سه پارامتر است: خوشه، فضای نام و کاربر. به طور پیش‌فرض، ابزار خط فرمان `kubectl` از پارامترهای context کنونی برای ارتباط با خوشه استفاده می‌کند.

برای انتخاب context کنونی:

```
kubectl config use-context
```

## متغیر محیطی KUBECONFIG

متغیر محیطی `KUBECONFIG` یک لیست از فایل‌های kubeconfig را نگه می‌دارد. برای لینوکس و مک، لیست با استفاده از دونقطه جدا شده است. برای ویندوز، لیست با استفاده از نقطه ویرگول جدا شده است. متغیر محیطی `KUBECONFIG` لازم نیست. اگر متغیر محیطی `KUBECONFIG` وجود نداشته باشد، `kubectl` از فایل kubeconfig پیش‌فرض، `$HOME/.kube/config` استفاده می‌کند.

اگر متغیر محیطی `KUBECONFIG` وجود داشته باشد، `kubectl` از یک پیکربندی مؤثر استفاده می‌کند که نتیجه ادغام فایل‌های موجود در متغیر `KUBECONFIG` است.

## ادغام فایل‌های kubeconfig

برای دیدن پیکربندی خود، این دستور را وارد کنید:

```shell
kubectl config view
```

همانطور که قبلاً توضیح داده شد، خروجی ممکن است از یک فایل kubeconfig تکی باشد، یا نتیجه ادغام چندین فایل kubeconfig باشد.

اینجا قوانینی هستند که `kubectl` هنگام ادغام فایل‌های kubeconfig استفاده می‌کند:

1. اگر پرچم `--kubeconfig` تنظیم شده باشد، فقط از فایل مشخص شده استفاده کنید. ادغام نکنید.
   فقط یک نمونه از این پرچم مجاز است.

   در غیر این صورت، اگر متغیر محیطی `KUBECONFIG` تنظیم شده باشد، آن را به عنوان
   یک لیستی از فایل‌هایی که باید ادغام شوند، استفاده کنید.
   فایل‌های موجود در متغیر محیطی `KUBECONFIG` را بر اساس این قوانین ادغام کنید:

   * نام‌های خالی را

 نادیده بگیرید.
   * خطاها را برای فایل‌هایی که محتوای آنها قابل تجزیه نیست، تولید کنید.
   * اولین فایلی که یک مقدار یا کلید نقشه خاص را تنظیم می‌کند، برنده است.
   * هیچ وقت مقدار یا کلید نقشه را تغییر ندهید.
     مثال: Context اولین فایلی است که `current-context` را تنظیم کند.
     مثال: اگر دو فایل مقدار `red-user` را مشخص کنند، فقط از مقادیر فایل اول استفاده کنید.
     حتی اگر فایل دوم مقادیر غیر تضادی زیر `red-user` داشته باشد، آنها را دور بریزید.

   برای مثالی از تنظیم متغیر محیطی `KUBECONFIG`، به [تنظیم متغیر محیطی KUBECONFIG](/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#set-the-kubeconfig-environment-variable) مراجعه کنید.

   در غیر این صورت، از فایل kubeconfig پیش‌فرض، `$HOME/.kube/config` بدون ادغام استفاده کنید.

1. Context مورد استفاده را بر اساس اولین وقوع در این زنجیره تعیین کنید:

    1. اگر پرچم خط فرمان `--context` وجود داشته باشد، از آن استفاده کنید.
    1. از `current-context` در فایل‌های kubeconfig ادغام شده استفاده کنید.

   یک context خالی در این نقطه مجاز است.

1. اطلاعات خوشه و کاربر را تعیین کنید. در این نقطه ممکن است context وجود داشته باشد یا نداشته باشد.
   اطلاعات خوشه و کاربر را بر اساس اولین وقوع در این زنجیره تعیین کنید، که یک بار برای کاربر و یک بار برای خوشه انجام می‌شود:

   1. اگر پرچم خط فرمان `--user` یا `--cluster` وجود داشته باشد، از آن استفاده کنید.
   1. اگر context خالی نباشد، کاربر یا خوشه را از context استفاده کنید.

   کاربر و خوشه می‌توانند در این نقطه خالی باشند.

1. اطلاعات دقیق خوشه را برای استفاده تعیین کنید. در این نقطه ممکن است اطلاعات خوشه وجود داشته باشد یا نداشته باشد.
   هر قسمت از اطلاعات خوشه را بر اساس این زنجیره ایجاد کنید؛ برنده اولین وقوع می‌باشد:

   1. از پرچم‌های خط فرمان اگر وجود داشته باشد استفاده کنید: `--server`، `--certificate-authority`، `--insecure-skip-tls-verify`.
   1. اگر هر یک از ویژگی‌های اطلاعات خوشه از فایل‌های kubeconfig ادغام شده وجود داشته باشد، از آن استفاده کنید.
   1. اگر مکان سرور وجود نداشته باشد، شکست بخورید.

1. اطلاعات دقیق کاربر را برای استفاده تعیین کنید. اطلاعات کاربر را با استفاده از قوانین مشابه اطلاعات خوشه ایجاد کنید، به جز این که فقط یک تکنیک احراز هویت برای هر کاربر مجاز است:

   1. اگر پرچم‌های خط فرمان وجود داشته باشند، از آنها استفاده کنید: `--client-certificate`، `--client-key`، `--username`، `--password`، `--token`.
   1. از فیلدهای `user` در فایل‌های kubeconfig ادغام شده استفاده کنید.
   1. اگر دو روش متضاد وجود داشته باشد، شکست بخورید.

1. برای هر اطلاعاتی که هنوز موجود نباشد، از مقادیر پیش‌فرض استفاده کنید و به طور پتانسیل برای اطلاعات احراز هویت پرسمان بزنید.

## مراجعه فایل‌ها

مراجعه به فایل‌ها و مسیرهای در یک فایل kubeconfig نسبت به مکان فایل kubeconfig نسبتی است و مراجعه به مسیرها در خط فرمان نسبت به دایرکتوری کاری جاری است. در `$HOME/.kube/config`، مسیرهای نسبتی نگهداری می‌شوند و مسیرهای مطلق نگهداری می‌شوند.

## پروکسی

می‌توانید `kubectl` را پیکربندی کنید تا برای هر خوشه از یک پروکسی استفاده کند، با استفاده از `proxy-url` در فایل kubeconfig خود، مانند این:

```yaml
apiVersion: v1
kind: Config

clusters:
- cluster:
    proxy-url: http://proxy.example.org:3128
    server: https://k8s.example.org/k8s/clusters/c-xxyyzz
  name: development

users:
- name: developer

contexts:
- context:
  name: development
```

## {{% heading "whatsnext" %}}

* [پیکربندی دسترسی به چندین خوشه](/docs/tasks/access-application-cluster/configure-access-multiple-clusters/)
* [`kubectl config`](/docs/reference/generated/kubectl/kubectl-commands#config)
