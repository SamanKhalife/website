---
title: مالکان و وابستگان
content_type: مفهوم
weight: 90
---

<!-- overview -->

در Kubernetes، برخی {{< glossary_tooltip text="اشیاء" term_id="object" >}} به عنوان
*مالک* برخی اشیاء دیگر هستند. به عنوان مثال،
یک {{<glossary_tooltip text="ReplicaSet" term_id="replica-set">}} مالک یک مجموعه از Pods است.
این اشیاء وابسته، *وابستگان* مالک خود هستند.

مالکیت با مکانیزم [برچسب‌ها و انتخاب‌کننده‌ها](/docs/concepts/overview/working-with-objects/labels/)
که برخی از منابع همچنین استفاده می‌کنند، متفاوت است. به عنوان مثال، یک Service که
اشیاء `EndpointSlice` ایجاد می‌کند، از {{<glossary_tooltip text="برچسب‌ها" term_id="label">}} برای این استفاده می‌کند تا موتور کنترل بتواند تشخیص دهد که اشیاء `EndpointSlice` کدامیک برای آن Service استفاده می‌شوند. علاوه بر این برچسب‌ها، هر `EndpointSlice` که به نام یک Service مدیریت می‌شود، یک ارجاع مالک دارد. ارجاع‌های مالک کمک می‌کنند که بخش‌های مختلف Kubernetes از مداخله در اشیاء که آنها کنترلی بر آنها ندارند، خودداری کنند.

## ارجاع‌های مالک در مشخصات اشیاء

اشیاء وابسته دارای فیلد `metadata.ownerReferences` هستند که به اشیاء مالک خود ارجاع می‌دهد. یک ارجاع مالک معتبر از نام شی و یک {{<glossary_tooltip text="UID" term_id="uid">}}
در همان {{<glossary_tooltip text="فضای‌نام" term_id="namespace">}} به عنوان شی وابسته تشکیل شده است. Kubernetes مقدار این فیلد را به‌طور خودکار برای اشیاء که وابسته به سایر اشیاء مانند ReplicaSets، DaemonSets، Deployments، Jobs و CronJobs هستند، تنظیم می‌کند. همچنین می‌توانید به صورت دستی این ارتباطات را پیکربندی کنید، اما معمولاً نیازی به این کار نیست و می‌توانید به Kubernetes اجازه دهید این روابط را به طور خودکار مدیریت کند.

اشیاء وابسته همچنین دارای فیلد `ownerReferences.blockOwnerDeletion` هستند که مقدار بولی دارد و کنترل می‌کند که آیا وابستگان خاص می‌توانند از حذف شی مالک خود جلوگیری کنند یا خیر. Kubernetes این فیلد را به‌طور خودکار به `true` تنظیم می‌کند اگر یک {{<glossary_tooltip text="کنترل‌کننده" term_id="controller">}}
(مانند کنترل‌کننده Deployment) مقدار فیلد `metadata.ownerReferences` را تنظیم کند. همچنین می‌توانید مقدار فیلد `blockOwnerDeletion` را به‌طور دستی تنظیم کنید تا کنترل کنید که کدام وابستگان جلوی گردآوری زباله از حذف شی مالک را می‌گیرند.

یک کنترل‌کننده تصدیق کننده Kubernetes دسترسی کاربر به تغییر این فیلد برای منابع وابسته را بر اساس مجوزهای حذف شی مالک کنترل می‌کند. این کنترل جلوی کاربران غیرمجاز از تاخیر حذف شی مالک را می‌گیرد.

{{< note >}}
ارجاع‌های مالک از فضای‌نام‌های متقاطع به طور طراحی ممنوع است.
وابستگان محدود به مالک‌های متقاطع یا فضای‌نام‌های خود هستند.
یک مالک فضای‌نام باید حتماً در همان فضای‌نامی وجود داشته باشد که وابسته است.
اگر اینطور نباشد، ارجاع مالک به عنوان غایب در نظر گرفته می‌شود و وابسته
به حذف می‌رود هنگامی که تمام مالک‌ها غایب محسوب شوند.

وابستگان محدود به مالک‌های متقاطع امکان تعیین مالک‌های متقاطع را ندارند.
در v1.20+، اگر وابسته متقاطع یک نوع نام‌گذاری‌شده در فضای‌نام‌ها را به عنوان یک مالک مشخص کند، به عنوان ارجاع غیرقابل‌حل مالک محسوب می‌شود و نمی‌تواند گردآوری زباله شود.

در v1.20+، اگر گردآوری زباله ارجاع‌های نام‌گذاری‌شده مالک نام‌گذاری‌شده متقاطع نامعتبر یا یک وابسته متقاطع با ارجاع‌های مالک به نوع نام‌گذاری‌شده فضای‌نام، یک رویداد هشداردهنده با دلیل `OwnerRefInvalidNamespace` و `involvedObject` از وابسته نامعتبر گزارش می‌شود.
شما می‌توانید برای آن نوع رویداد با اجرای `kubectl get events -A --field-selector=reason=OwnerRefInvalidNamespace` چک کنید.
{{< /note >}}

## مالکیت و نهایی‌کننده‌ها

زمانی که به Kubernetes می‌گویید که یک منبع را حذف کند، سرور API به کنترل‌کننده مدیریتی اجازه می‌دهد تا هر [قانون نهایی‌کننده](/docs/concepts/overview/working-with-objects/finalizers/)
را برای منبع پردازش کند. {{<glossary_tooltip text="نهایی‌کننده‌ها" term_id="finalizer">}}
جلوگیری از حذف اتفاقی منابعی که خوش‌حالی خواهد بود که خوش‌حالی برای عملکرد
سرور نمی‌تواند برای مثال، اگر به سعی برای حذف یک [پیوسته‌والوم](/docs/concepts/storage/persistent-volumes/) که هنوز
در استفاده از یک Pod است، حذف به طور فوری اتفاق نمی‌افتد زیرا این
`PersistentVolume` را `kubernetes.io/pv-protection`
نهایی‌کننده روی آن است. به جای آن، [والوم](/docs/concepts/storage/volumes/) هنوز در وضعیت
`Terminating` مانده است تا زمانی که Kubernetes پاک می‌کند
نهایی‌کننده که فقط اتفاق می‌افتد بعد از آن `PersistentVolume` دیگر نیست
به Pod.

Kubernetes همچنین نهایی‌کننده را به منبع مالک اضافه می‌کند وقتی که شما یا
[پیش‌زمینه یا یتیم حذف](/docs/concepts/architecture/garbage-collection/#cascading-deletion)
در فرانت نهایی حذف، آن را اضافه می‌کند `foreground` نهایی به آن
کنترل‌کننده باید حذف منابع وابسته که همچنین دارد
`ownerReferences.blockOwnerDeletion=true` قبل از آن حذف مالک. اگر شما
درخواستی برای حذف یتیم، Kubernetes اضافه می‌کند `orphan`
نهایی به آن کنترل‌کننده باید نادیده گرفتن منابع وابسته پس از آن حذف
شی مالک آبجکت.

## {{% heading "whatsnext" %}}

* بیشتر بدانید [درباره نهایی‌کننده‌های Kubernetes](/docs/concepts/overview/working-with-objects/finalizers/).
* بیاموزید درباره [جمع‌آوری زباله](/docs/concepts/architecture/garbage-collection).
* مطالعه مرجع API برای [اشیاء متا](/docs/reference/kubernetes-api/common-definitions/object-meta/#System).
