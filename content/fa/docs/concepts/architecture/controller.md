---
title: کنترلرها
content_type: concept
weight: 30
---

<!-- overview -->

در رباتیک و اتوماسیون، یک _حلقه کنترل_ یک حلقه غیر‌پایان‌پذیر است که وضعیت یک سیستم را تنظیم می‌کند.

در اینجا یک مثال از حلقه کنترل آمده است: ترموستات در یک اتاق.

وقتی دما را تنظیم می‌کنید، این کار به ترموستات وضعیت *مطلوب* شما را می‌گوید. دمای واقعی اتاق وضعیت *فعلی* است. ترموستات عمل می‌کند تا وضعیت فعلی را به وضعیت مطلوب نزدیک کند، با روشن یا خاموش کردن تجهیزات.

{{< glossary_definition term_id="controller" length="short">}}



<!-- body -->

## الگوی کنترلر

یک کنترلر حداقل یک نوع منبع Kubernetes را پیگیری می‌کند. این {{< glossary_tooltip text="objects" term_id="object" >}} یک فیلد spec دارند که وضعیت مطلوب را نشان می‌دهد. کنترلر(های) این منبع مسئول نزدیک کردن وضعیت فعلی به وضعیت مطلوب هستند.

کنترلر ممکن است عمل را خودش انجام دهد؛ در Kubernetes به‌طور معمول، یک کنترلر پیام‌هایی به {{< glossary_tooltip text="API server" term_id="kube-apiserver" >}} ارسال می‌کند که اثرات جانبی مفیدی دارند. مثال‌هایی از این موضوع را در زیر مشاهده خواهید کرد.

{{< comment >}}
برخی از کنترلرهای داخلی، مانند کنترلر namespace، بر روی اشیایی عمل می‌کنند که spec ندارند. برای سادگی، این صفحه از توضیح آن جزئیات صرف‌نظر می‌کند.
{{< /comment >}}

### کنترل از طریق API server

کنترلر {{< glossary_tooltip term_id="job" >}} نمونه‌ای از یک کنترلر داخلی Kubernetes است. کنترلرهای داخلی با تعامل با API server خوشه، وضعیت را مدیریت می‌کنند.

Job یک منبع Kubernetes است که یک {{< glossary_tooltip term_id="pod" >}}، یا شاید چندین Pod، را اجرا می‌کند تا یک کار را انجام دهد و سپس متوقف شود.

(پس از [زمانبندی شدن](/docs/concepts/scheduling-eviction/)، اشیاء Pod بخشی از وضعیت مطلوب برای یک kubelet می‌شوند).

وقتی کنترلر Job یک کار جدید را می‌بیند، اطمینان حاصل می‌کند که در جایی از خوشه شما، kubeletهای موجود در مجموعه‌ای از Nodes در حال اجرای تعداد مناسبی از Pods برای انجام کار هستند.
کنترلر Job هیچ Pod یا containerی را خودش اجرا نمی‌کند. در عوض، کنترلر Job به API server می‌گوید که Pods ایجاد یا حذف کند.
سایر اجزا در {{< glossary_tooltip text="control plane" term_id="control-plane" >}} بر روی اطلاعات جدید عمل می‌کنند (Podهای جدیدی برای زمانبندی و اجرا وجود دارند)، و در نهایت کار انجام می‌شود.

بعد از ایجاد یک Job جدید، وضعیت مطلوب این است که آن Job تکمیل شود.
کنترلر Job وضعیت فعلی آن Job را به وضعیت مطلوب شما نزدیک‌تر می‌کند: ایجاد Podهایی که کاری را که برای آن Job می‌خواستید انجام دهند، بنابراین Job به تکمیل نزدیک‌تر می‌شود.

کنترلرها همچنین اشیایی را که آن‌ها را پیکربندی می‌کنند به‌روزرسانی می‌کنند.
به عنوان مثال: هنگامی که کار برای یک Job انجام شد، کنترلر Job آن شیء Job را به‌روزرسانی می‌کند تا آن را `Finished` علامت بزند.

(این شبیه به این است که چگونه برخی از ترموستات‌ها یک چراغ را خاموش می‌کنند تا نشان دهند که اتاق شما اکنون در دمایی است که تنظیم کرده‌اید).

### کنترل مستقیم

در مقابل Job، برخی از کنترلرها نیاز دارند که تغییراتی را در چیزهای خارج از خوشه شما ایجاد کنند.

به عنوان مثال، اگر از یک حلقه کنترل برای اطمینان از اینکه به اندازه کافی {{< glossary_tooltip text="Nodes" term_id="node" >}} در خوشه شما وجود دارد استفاده می‌کنید، آن کنترلر به چیزی خارج از خوشه فعلی نیاز دارد تا Nodes جدیدی را در صورت نیاز راه‌اندازی کند.

کنترلرهایی که با وضعیت خارجی تعامل دارند، وضعیت مطلوب خود را از API server می‌گیرند، سپس مستقیماً با یک سیستم خارجی ارتباط برقرار می‌کنند تا وضعیت فعلی را به وضعیت مطلوب نزدیک‌تر کنند.

(در واقع یک [کنترلر](https://github.com/kubernetes/autoscaler/) وجود دارد که Nodes را در خوشه شما به صورت افقی مقیاس‌بندی می‌کند).

نکته مهم در اینجا این است که کنترلر تغییراتی ایجاد می‌کند تا وضعیت مطلوب شما را به ارمغان آورد، و سپس وضعیت فعلی را به API server خوشه شما گزارش می‌دهد.
حلقه‌های کنترل دیگر می‌توانند آن داده‌های گزارش شده را مشاهده کرده و اقدامات خود را انجام دهند.

در مثال ترموستات، اگر اتاق بسیار سرد باشد، یک کنترلر دیگر ممکن است یک هیتر حفاظت از یخ‌زدگی را نیز روشن کند. با خوشه‌های Kubernetes، صفحه کنترل به‌طور غیرمستقیم با ابزارهای مدیریت آدرس IP، خدمات ذخیره‌سازی، APIهای ارائه‌دهنده ابر و سایر خدمات با [گسترش Kubernetes](/docs/concepts/extend-kubernetes/) کار می‌کند تا آن را پیاده‌سازی کند.

## وضعیت مطلوب در مقابل وضعیت فعلی {#desired-vs-current}

Kubernetes یک دیدگاه بومی ابری از سیستم‌ها دارد و قادر به مدیریت تغییرات مداوم است.

خوشه شما می‌تواند در هر نقطه‌ای تغییر کند زیرا کارها انجام می‌شود و حلقه‌های کنترل به‌طور خودکار خرابی‌ها را اصلاح می‌کنند. این به این معنی است که به‌طور بالقوه، خوشه شما هرگز به یک وضعیت پایدار نمی‌رسد.

تا زمانی که کنترلرهای خوشه شما در حال اجرا هستند و قادر به ایجاد تغییرات مفید هستند، مهم نیست که وضعیت کلی پایدار باشد یا خیر.

## طراحی

به عنوان یک اصل طراحی، Kubernetes از تعداد زیادی کنترلر استفاده می‌کند که هر کدام یک جنبه خاص از وضعیت خوشه را مدیریت می‌کنند. به‌طور معمول، یک حلقه کنترل (کنترلر) خاص از یک نوع منبع به عنوان وضعیت مطلوب خود استفاده می‌کند و یک نوع منبع متفاوت را مدیریت می‌کند تا آن وضعیت مطلوب را محقق کند. به عنوان مثال، یک کنترلر برای Jobs اشیاء Job را پیگیری می‌کند (برای کشف کارهای جدید) و اشیاء Pod را (برای اجرای Jobs، و سپس برای دیدن زمانی که کار تمام شد) پیگیری می‌کند. در این مورد، چیز دیگری Jobs را ایجاد می‌کند، در حالی که کنترلر Job Pods را ایجاد می‌کند.

داشتن کنترلرهای ساده بهتر است تا یک مجموعه یکپارچه از حلقه‌های کنترل که به هم پیوسته‌اند. کنترلرها ممکن است شکست بخورند، بنابراین Kubernetes برای این طراحی شده است.

{{< note >}}
چندین کنترلر می‌توانند همان نوع شیء را ایجاد یا به‌روزرسانی کنند.
پشت صحنه، کنترلرهای Kubernetes اطمینان حاصل می‌کنند که فقط به منابع مرتبط با منبع کنترلی خود توجه می‌کنند.

به عنوان مثال، شما می‌توانید Deployments و Jobs داشته باشید؛ این‌ها هر دو Pods را ایجاد می‌کنند.
کنترلر Job Podsی را که Deployment شما ایجاد کرده است حذف نمی‌کند، زیرا اطلاعاتی ({{< glossary_tooltip term_id="label" text="labels" >}}) وجود دارد که کنترلرها می‌توانند از آن‌ها استفاده کنند تا آن Pods را از هم متمایز کنند.
{{< /note >}}

## روش‌های اجرای کنترلرها {#running-controllers}

Kubernetes با مجموعه‌ای از کنترلرهای داخلی که در {{< glossary_tooltip term_id="kube-controller-manager" >}} اجرا می‌شوند همراه است. این کنترلرهای داخلی رفتارهای هسته‌ای مهمی را ارائه می‌دهند.

کنترلر Deployment و کنترلر Job نمونه‌هایی از کنترلرهایی هستند که به عنوان بخشی از Kubernetes می‌آیند ("کنترلرهای داخلی").
Kubernetes به شما اجازه می‌دهد تا یک صفحه کنترل مقاوم اجرا کنید، به‌طوری که اگر هر یک از کنترلرهای داخلی شکست بخورند، قسمت دیگری از صفحه کنترل کار را به عهده بگیرد.

شما می‌توانید کنترلرهایی پیدا کنید که خارج از صفحه کنترل اجرا می‌شوند تا Kubernetes را گسترش دهند.
یا، اگر بخواهید، می‌توانید یک کنترلر جدید خود بنویسید.
می‌توانید کنترلر خود را به عنوان مجموعه‌ای از Pods اجرا کنید، یا خارج از Kubernetes. اینکه چه چیزی بهترین است بستگی به آن کنترلر خاص دارد که چه کاری انجام می‌دهد.

## {{% heading "whatsnext" %}}

* درباره [صفحه کنترل Kubernetes](/docs/concepts/overview/components/#control-plane-components) بخوانید
* برخی از [اشیاء پایه Kubernetes](/docs/concepts/overview/working-with-objects/) را کشف کنید
* بیشتر درباره [API Kubernetes](/docs/concepts/overview/kubernetes-api/) بیاموزید
* اگر می‌خواهید کنترلر خود را بنویسید، [الگوهای گسترش Kubernetes](/docs/concepts/extend-kubernetes/#extension-patterns) و مخزن [sample-controller](https://github.com/kubernetes/sample-controller) را ببینید.
