---
title: روش‌های خوب برای مدیریت Secrets در Kubernetes
description: >
  اصول و روش‌های خوب برای مدیریت مناسب Secrets برای مدیران خوشه و توسعه‌دهندگان برنامه.
content_type: concept
weight: 70
---

<!-- overview -->

{{<glossary_definition prepend="در Kubernetes، Secret یک شیء است که"
term_id="secret" length="all">}}

روش‌های خوب زیر برای هم مدیران خوشه و هم توسعه‌دهندگان برنامه طراحی شده‌اند. از این دستورالعمل‌ها برای بهبود امنیت اطلاعات حساس خود در اشیاء Secret استفاده کنید، همچنین برای مدیریت موثرتر Secrets خود.

<!-- body -->

## مدیران خوشه

این بخش شامل روش‌های خوبی است که مدیران خوشه می‌توانند برای بهبود امنیت اطلاعات محرمانه در خوشه استفاده کنند.

### پیکربندی رمزنگاری در استراحت

به طور پیش‌فرض، اشیاء Secret به صورت رمزنگاری نشده در {{<glossary_tooltip
term_id="etcd" text="etcd">}} ذخیره می‌شوند. شما باید رمزنگاری داده‌های Secret خود را در `etcd` پیکربندی کنید. برای دستورالعمل‌ها، به
[Encrypt Secret Data at Rest](/docs/tasks/administer-cluster/encrypt-data/)
مراجعه کنید.

### پیکربندی دسترسی با حداقل امتیاز به Secrets {#least-privilege-secrets}

هنگام برنامه‌ریزی مکانیزم کنترل دسترسی خود، مانند
{{<glossary_tooltip term_id="rbac" text="Role-based Access Control">}} [(RBAC)](/docs/reference/access-authn-authz/rbac/) Kubernetes را در نظر بگیرید، مراجعه به دستورالعمل‌های زیر برای دسترسی به اشیاء `Secret`. همچنین، دستورالعمل‌های دیگر را در
[Best Practices RBAC](/docs/concepts/security/rbac-good-practices)
دنبال کنید.

- **اجزاء**: دسترسی `watch` یا `list` را فقط به اجزاء سطح سیستمی و محدودترین مجازیت‌ها اجازه دهید. فقط دسترسی `get` برای Secrets را اگر رفتار طبیعی اجزاء نیاز دارد.
- **انسان‌ها**: دسترسی `get`، `watch`، یا `list` به Secrets را محدود کنید. فقط به مدیران خوشه اجازه دسترسی به `etcd` را بدهید. این شامل دسترسی فقط خواندنی است. برای کنترل دسترسی پیچیده‌تر، مانند محدود کردن دسترسی به Secrets با توجه به توضیحات خاص، از مکانیزم‌های اجازه دهنده شخص ثالث استفاده کنید.

{{< caution >}}
اعطای دسترسی `list` به Secrets به طور ضمنی به موضوع اجازه می‌دهد که محتویات Secrets را دریافت کند.
{{< /caution >}}

یک کاربری که می‌تواند یک Pod ایجاد کند که از یک Secret استفاده می‌کند، می‌تواند ارزش آن Secret را ببیند. حتی اگر سیاست‌های خوشه اجازه مستقیم خواندن Secret را به یک کاربر ندهد، همین کاربر می‌تواند دسترسی داشته باشد تا یک Pod را اجرا کند که سپس Secret را فاش می‌کند. می‌توانید تاثیر انحراف یا محدود کردن اطلاعات Secret که به طور ارادی یا غیر ارادی توسط کاربر با این دسترسی فاش می‌شود، را شناسایی یا محدود کنید. برخی پیشنهادات شامل:

* استفاده از Secrets با مدت زمان کوتاه
* اجرای قوانین مروری که بر رویدادهای خاص هشدار می‌دهند، مانند خواندن همزمان چندین Secret توسط یک کاربر واحد

#### توضیحات اضافی ServiceAccount برای مدیریت Secret

می‌توانید همچنین از شماره توضیحات `kubernetes.io/enforce-mountable-secrets` بر روی یک ServiceAccount برای اعمال قواعد خاص در مورد استفاده از Secrets در یک Pod استفاده کنید. برای جزئیات بیشتر، به [مستندات این شماره](/docs/reference/labels-annotations-taints/#enforce-mountable-secrets) مراجعه کنید.

### بهبود سیاست‌های مدیریت etcd

در نظر بگیرید پاک کردن یا خرد کردن ذخیره سازی دائمی استفاده شده توسط `etcd` وقتی که دیگر استفاده نمی‌شود.

اگر چندین نمونه `etcd` وجود دارد، پیکربندی ارتباط رمزنگاری شده SSL/TLS بین نمونه‌ها را برای حفاظت از داده‌های Secret در حالت عبوری پیکربندی کنید.

### پیکربندی دسترسی به Secrets خارجی

{{% thirdparty-content %}}

می‌توانید از ارائه‌دهندگان مخفی‌گاه‌های شخص ثالث استفاده کنید تا اطلاعات محرمانه‌تان را خارج از خوشه خود نگهداری کنید و سپس Pods را پیکربندی کنید تا به آن اطلاعات دسترسی پیدا کنند. 
[Kubernetes Secrets Store CSI Driver](https://secrets-store-csi-driver.sigs.k8s.io/)
یک DaemonSet است که به kubelet اجازه می‌دهد تا Secrets را از ذخیره‌گاه‌های خارجی بازیابی کند، و Secrets را به عنوان یک مجلد به Pods خاصی که شما اجازه دسترسی به داده‌ها را می‌دهید متصل کند.

برای فهرستی از ارائه‌دهندگان پشتیبانی شده، به
[Providers for the Secret Store CSI Driver](https://secrets-store-csi-driver.sigs.k8s.io/concepts.html#provider-for-the-secrets-store-csi-driver)
مراجعه کنید.

## توسعه‌دهندگان

این بخش شامل روش‌های خوبی است که توسعه‌دهندگان می‌توانند برای بهبود امنیت داده‌های محرمانه هنگام ساخت و پیکربندی منابع Kubernetes استفاده کنند.

### محدود کردن دسترسی به Secret به کانتینرهای خاص

اگر شما چندین کانتینر را در یک Pod تعریف می‌کنید و تنها یکی از این کانتینرها به یک Secret نیاز دارد، پیکربندی مانت ولوم یا متغیر محیطی را طوری تعریف کنید که دیگر کانتینرها دسترسی به آن Secret نداشته باشند.

### حفاظت از داده‌های Secret پس از خواندن

برنامه‌ها هنوز نیاز به حفاظت از مقدار اطلاعات محرمانه پس از خواندن آن از متغیر محیطی یا ولوم دارند. به عنوان مثال، برنامه شما باید از ثبت داده‌های محرمانه به صورت روشن خودداری کند یا آن را به طرف غیرقابل اعتماد انتقال ندهد.

### اجتناب از به اشتراک گذاری نماینده‌های Secret

اگر یک Secret را از طریق یک
{{< glossary_tooltip text="manifest" term_id="manifest" >}}
پیکربندی کرده‌اید، با داده‌های Secret به عنوان base64 مشفر شده، به اشتراک گذاشتن این پرونده یا چک کردن آن به مخزن منبع به معنای این است که Secret برای همه کسانی که می‌توانند مانیفست را بخوانند، در دسترس است.

{{< caution >}}
کدگذاری Base64 یک روش رمزگذاری نیست، بلکه هیچ محرمانگی اضافی نسبت به متن ساده ارائه نمی‌دهد.
{{< /caution >}}
