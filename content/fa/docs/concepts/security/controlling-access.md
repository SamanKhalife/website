---
reviewers:
- erictune
- lavalamp
title: کنترل دسترسی به Kubernetes API
content_type: concept
weight: 50
---

<!-- overview -->
این صفحه مروری بر کنترل دسترسی به Kubernetes API ارائه می‌دهد.

<!-- body -->
کاربران به [Kubernetes API](/docs/concepts/overview/kubernetes-api/) با استفاده از `kubectl`,
کتابخانه‌های مشتری، یا با ارسال درخواست‌های REST دسترسی پیدا می‌کنند. هر دو کاربر انسانی و
[حساب‌های سرویس Kubernetes](/docs/tasks/configure-pod-container/configure-service-account/) می‌توانند برای دسترسی به API مجاز شوند.
وقتی یک درخواست به API می‌رسد، از چند مرحله عبور می‌کند که در نمودار زیر نشان داده شده است:

![Diagram of request handling steps for Kubernetes API request](/images/docs/admin/access-control-overview.svg)

## امنیت انتقال

به طور پیش‌فرض، سرور API Kubernetes روی پورت ۶۴۴۳ روی اولین واسط شبکه غیر-localhost گوش می‌دهد که توسط TLS محافظت می‌شود. در یک کلاستر Kubernetes تولیدی معمولی، API روی پورت ۴۴۳ سرویس می‌دهد. پورت می‌تواند با `--secure-port` تغییر کند و آدرس IP شنیداری با پرچم `--bind-address` تنظیم شود.

سرور API یک گواهینامه ارائه می‌دهد. این گواهینامه ممکن است با استفاده از یک مرجع گواهینامه خصوصی (CA) امضا شده باشد یا بر اساس زیرساخت کلید عمومی مرتبط با یک CA عمومی شناخته شده باشد. گواهینامه و کلید خصوصی مربوطه می‌توانند با استفاده از پرچم‌های `--tls-cert-file` و `--tls-private-key-file` تنظیم شوند.

اگر کلاستر شما از یک مرجع گواهینامه خصوصی استفاده می‌کند، شما به یک نسخه از آن گواهینامه CA نیاز دارید که در `~/.kube/config` روی مشتری تنظیم شده باشد، تا بتوانید به اتصال اعتماد کنید و اطمینان حاصل کنید که رهگیری نشده است.

مشتری شما می‌تواند در این مرحله یک گواهینامه مشتری TLS ارائه دهد.

## احراز هویت

پس از برقراری TLS، درخواست HTTP به مرحله احراز هویت می‌رود.
این به عنوان مرحله **1** در نمودار نشان داده شده است.
اسکریپت ایجاد کلاستر یا مدیر کلاستر، سرور API را برای اجرای یک یا چند ماژول احراز هویت پیکربندی می‌کند.
احراز هویت‌ها به طور مفصل‌تر در [احراز هویت](/docs/reference/access-authn-authz/authentication/) توضیح داده شده‌اند.

ورودی به مرحله احراز هویت کل درخواست HTTP است؛ با این حال، معمولاً هدرها و/یا گواهینامه مشتری را بررسی می‌کند.

ماژول‌های احراز هویت شامل گواهینامه‌های مشتری، رمز عبور و نشانه‌های ساده، نشانه‌های bootstrap و نشانه‌های وب JSON (که برای حساب‌های سرویس استفاده می‌شوند) هستند.

چندین ماژول احراز هویت می‌توانند مشخص شوند، در این صورت هر یک به ترتیب امتحان می‌شوند تا یکی از آنها موفق شود.

اگر درخواست نتواند احراز هویت شود، با کد وضعیت HTTP 401 رد می‌شود.
در غیر این صورت، کاربر به عنوان یک `username` خاص احراز هویت می‌شود و نام کاربر برای استفاده در مراحل بعدی در دسترس است. برخی از احراز هویت‌ها همچنین عضویت گروه‌های کاربر را ارائه می‌دهند، در حالی که دیگر احراز هویت‌ها این کار را نمی‌کنند.

در حالی که Kubernetes از نام‌های کاربری برای تصمیمات کنترل دسترسی و در ثبت درخواست‌ها استفاده می‌کند، هیچ شیء `User` ندارد و اطلاعاتی درباره کاربران در API خود ذخیره نمی‌کند.

## مجوز

پس از اینکه درخواست به عنوان یک کاربر خاص احراز هویت شد، درخواست باید مجاز شود. این به عنوان مرحله **2** در نمودار نشان داده شده است.

یک درخواست باید شامل نام کاربری درخواست‌کننده، عمل درخواست شده و شیء تأثیرپذیر از عمل باشد. درخواست مجاز است اگر یک سیاست موجود اعلام کند که کاربر مجاز به انجام عمل درخواست شده است.

به عنوان مثال، اگر باب سیاست زیر را داشته باشد، او می‌تواند فقط در namespace `projectCaribou` پادها را بخواند:

```json
{
    "apiVersion": "abac.authorization.kubernetes.io/v1beta1",
    "kind": "Policy",
    "spec": {
        "user": "bob",
        "namespace": "projectCaribou",
        "resource": "pods",
        "readonly": true
    }
}
```

اگر باب درخواست زیر را بفرستد، درخواست مجاز است زیرا او مجاز به خواندن اشیاء در namespace `projectCaribou` است:

```json
{
  "apiVersion": "authorization.k8s.io/v1beta1",
  "kind": "SubjectAccessReview",
  "spec": {
    "resourceAttributes": {
      "namespace": "projectCaribou",
      "verb": "get",
      "group": "unicorn.example.org",
      "resource": "pods"
    }
  }
}
```

اگر باب درخواست نوشتن (`create` یا `update`) به اشیاء در namespace `projectCaribou` بفرستد، مجوز او رد می‌شود. اگر باب درخواست خواندن (`get`) اشیاء در namespace دیگری مانند `projectFish` بفرستد، مجوز او رد می‌شود.

مجوز Kubernetes نیاز دارد که شما از ویژگی‌های رایج REST برای تعامل با سیستم‌های کنترل دسترسی سازمانی یا ارائه‌دهنده ابری استفاده کنید.
استفاده از قالب‌بندی REST مهم است زیرا این سیستم‌های کنترل ممکن است با APIهای دیگری غیر از Kubernetes API تعامل داشته باشند.

Kubernetes از چندین ماژول مجوز مانند حالت ABAC، حالت RBAC و حالت Webhook پشتیبانی می‌کند. هنگامی که یک مدیر یک کلاستر ایجاد می‌کند، ماژول‌های مجوزی که باید در سرور API استفاده شوند را پیکربندی می‌کند. اگر بیش از یک ماژول مجوز پیکربندی شده باشد، Kubernetes هر ماژول را بررسی می‌کند و اگر هر ماژول درخواست را مجاز کند، درخواست می‌تواند ادامه یابد. اگر همه ماژول‌ها درخواست را رد کنند، درخواست رد می‌شود (کد وضعیت HTTP 403).

برای یادگیری بیشتر درباره مجوز Kubernetes، از جمله جزئیات درباره ایجاد سیاست‌ها با استفاده از ماژول‌های مجوز پشتیبانی شده، به [مجوز](/docs/reference/access-authn-authz/authorization/) مراجعه کنید.
## کنترل ورود

ماژول‌های کنترل ورود نرم‌افزارهایی هستند که می‌توانند درخواست‌ها را تغییر دهند یا رد کنند.
علاوه بر ویژگی‌هایی که ماژول‌های مجوز دارند، ماژول‌های کنترل ورود می‌توانند به محتوای شیء که در حال ایجاد یا تغییر است دسترسی داشته باشند.

کنترل‌کننده‌های ورود بر روی درخواست‌هایی که یک شیء را ایجاد، تغییر، حذف یا به آن وصل می‌شوند (پراکسی) عمل می‌کنند.
کنترل‌کننده‌های ورود بر روی درخواست‌هایی که فقط اشیاء را می‌خوانند عمل نمی‌کنند.
وقتی چندین کنترل‌کننده ورود پیکربندی می‌شوند، آنها به ترتیب فراخوانی می‌شوند.

این به عنوان مرحله **3** در نمودار نشان داده شده است.

بر خلاف ماژول‌های احراز هویت و مجوز، اگر هر ماژول کنترل ورود درخواست را رد کند، درخواست بلافاصله رد می‌شود.

علاوه بر رد کردن اشیاء، کنترل‌کننده‌های ورود می‌توانند تنظیمات پیش‌فرض پیچیده‌ای برای فیلدها قرار دهند.

ماژول‌های کنترل ورود موجود در [کنترل‌کننده‌های ورود](/docs/reference/access-authn-authz/admission-controllers/) توصیف شده‌اند.

وقتی یک درخواست از همه کنترل‌کننده‌های ورود عبور می‌کند، با استفاده از روتین‌های اعتبارسنجی برای شیء API مربوطه اعتبارسنجی می‌شود و سپس در فروشگاه اشیاء نوشته می‌شود (که به عنوان مرحله **4** نشان داده شده است).

## حسابرسی

حسابرسی Kubernetes یک مجموعه رکوردهای زمانی مرتبط با امنیت ارائه می‌دهد که دنباله‌ای از اقدامات در یک کلاستر را مستند می‌کند.
کلاستر فعالیت‌هایی که توسط کاربران، برنامه‌هایی که از Kubernetes API استفاده می‌کنند، و خود صفحه کنترل ایجاد می‌شود را حسابرسی می‌کند.

برای اطلاعات بیشتر، به [حسابرسی](/docs/tasks/debug/debug-cluster/audit/) مراجعه کنید.

## {{% heading "whatsnext" %}}

اسناد بیشتری در مورد احراز هویت، مجوز و کنترل دسترسی به API بخوانید:

- [احراز هویت](/docs/reference/access-authn-authz/authentication/)
   - [احراز هویت با نشانه‌های Bootstrap](/docs/reference/access-authn-authz/bootstrap-tokens/)
- [کنترل‌کننده‌های ورود](/docs/reference/access-authn-authz/admission-controllers/)
   - [کنترل ورود دینامیک](/docs/reference/access-authn-authz/extensible-admission-controllers/)
- [مجوز](/docs/reference/access-authn-authz/authorization/)
   - [کنترل دسترسی مبتنی بر نقش](/docs/reference/access-authn-authz/rbac/)
   - [کنترل دسترسی مبتنی بر ویژگی](/docs/reference/access-authn-authz/abac/)
   - [مجوز نود](/docs/reference/access-authn-authz/node/)
   - [مجوز Webhook](/docs/reference/access-authn-authz/webhook/)
- [درخواست‌های امضای گواهینامه](/docs/reference/access-authn-authz/certificate-signing-requests/)
   - شامل [تأیید/رد CSR](/docs/reference/access-authn-authz/certificate-signing-requests/#approval-rejection)
     و [امضای گواهینامه](/docs/reference/access-authn-authz/certificate-signing-requests/#signing)
- حساب‌های سرویس
  - [راهنمای توسعه‌دهنده](/docs/tasks/configure-pod-container/configure-service-account/)
  - [مدیریت](/docs/reference/access-authn-authz/service-accounts-admin/)

می‌توانید در مورد این موارد یاد بگیرید:
- چگونه پادها می‌توانند از
  [اسرار](/docs/concepts/configuration/secret/#service-accounts-automatically-create-and-attach-secrets-with-api-credentials)
  برای دریافت مدارک API استفاده کنند.
