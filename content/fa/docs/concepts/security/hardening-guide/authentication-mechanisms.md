---
title: راهنمای تقویت امنیت - مکانیسم‌های احراز هویت
description: >
  اطلاعاتی درباره گزینه‌های احراز هویت در Kubernetes و ویژگی‌های امنیتی آن‌ها.
content_type: مفهوم
weight: 90
---

<!-- خلاصه -->

انتخاب مکانیسم(های) مناسب احراز هویت، جزء جنبه‌های حیاتی امنیتی است که برای امنیت کلاستر خود باید به دقت در نظر گرفته شود. Kubernetes چندین مکانیسم احراز هویت داخلی را فراهم می‌کند، هر کدام با نقاط قوت و ضعف خود که در انتخاب بهترین مکانیسم احراز هویت برای کلاستر شما باید مورد بررسی دقیق قرار گیرد.

در کل، توصیه می‌شود تا حد امکان تعداد مکانیسم‌های احراز هویت را کاهش دهید تا مدیریت کاربران را ساده‌تر کرده و جلوگیری شود که کاربران دسترسی به کلاستری که دیگر نیاز به آن ندارند، حفظ کنند.

مهم است توجه داشت که Kubernetes دارای پایگاه داده کاربر داخلی در کلاستر نیست. به جای این کار، اطلاعات کاربر را از سیستم احراز هویت پیکربندی شده گرفته و از آن برای اتخاذ تصمیمات مجوز دسترسی استفاده می‌کند. بنابراین برای حسابرسی دسترسی کاربر، شما باید از اعتبارهای هر منبع احراز هویت پیکربندی شده استفاده کنید.

برای کلاسترهای تولید با چندین کاربری که به طور مستقیم به API Kubernetes دسترسی دارند، توصیه می‌شود از منابع احراز هویت خارجی مانند OIDC استفاده کنید. مکانیسم‌های احراز هویت داخلی مانند گواهی‌نامه‌های مشتری و توکن‌های حساب سرویس که در زیر توضیح داده شده‌اند، برای این حالت مناسب نیستند.

<!-- متن -->

## احراز هویت با گواهی‌نامه‌های مشتری X.509 {#x509-client-certificate-authentication}

Kubernetes از احراز هویت با گواهی‌نامه‌های مشتری [X.509](/docs/reference/access-authn-authz/authentication/#x509-client-certificates) برای اجزاء سیستم مانند زمانی که Kubelet به API Server احراز هویت می‌کند، استفاده می‌کند. این مکانیسم ممکن است برای احراز هویت کاربر مناسب نباشد به دلیل محدودیت‌های زیر:

- گواهی‌نامه‌های مشتری نمی‌توانند به طور جداگانه ابطال شوند. یکبار که به خطر افتاده‌اند، می‌توانند توسط حملات کننده استفاده شوند تا زمانی که منقضی شوند. برای کاهش این ریسک، توصیه می‌شود که برای احراز هویت کاربران از گواهی‌نامه‌های مشتری با مدت زمان کوتاه تنظیم کنید.
- اگر گواهی‌نامه نیاز به ابطال داشته باشد، باید مقام‌دهی گواهی‌نامه بازسازی شود که می‌تواند خطراتی از نظر در دسترس بودن به کلاستر به وجود آورد.
- هیچ سابقه دائمی از گواهی‌نامه‌های مشتری ایجاد شده در کلاستر وجود ندارد. بنابراین، تمام گواهی‌نامه‌های صادر شده باید ثبت شوند اگر بخواهید از آنها آگاه باشید.
- کلیدهای خصوصی استفاده شده برای احراز هویت با گواهی‌نامه‌های مشتری نمی‌توانند دارای رمز عبور باشند. هر کسی که توانایی خواندن فایل حاوی کلید را داشته باشد، می‌تواند از آن استفاده کند.
- استفاده از احراز هویت با گواهی‌نامه مشتری نیازمند اتصال مستقیم از مشتری به سرور API با نقاط پایانی TLS میانی نیست که می‌تواند معماری شبکه را پیچیده کند.
- داده گروه در مقدار `O` گواهی‌نامه مشتری جاسازی شده است که به این معنی است که عضویت‌های گروه کاربر برای مدت اعتبار گواهی‌نامه مشخص شده‌اند.

## فایل توکن استاتیک {#static-token-file}

اگرچه Kubernetes به شما امکان می‌دهد تا اعتبارها را از [فایل توکن استاتیک](/docs/reference/access-authn-authz/authentication/#static-token-file) موجود در دیسک‌های نودهای صفحه کنترل بارگیری کنید، این رویکرد به دلیل دلایل زیر برای سرورهای تولید توصیه نمی‌شود:

- اعتبارها به صورت متن ساده در دیسک‌های نود صفحه کنترل ذخیره می‌شوند که می‌تواند یک خطر امنیتی باشد.
- تغییر هر اعتبار نیاز به بازنشانی فرآیند سرور API دارد تا تأثیر گذار باشد که می‌تواند تأثیراتی بر روی دسترسی داشته باشد.
- هیچ مکانیسمی موجود نیست که به کاربران امکان بدهد تا اعتبارهای خود را چرخه‌اندازی کنند. برای چرخه‌اندازی یک اعتبار، مدیر کلاستر باید توکن را در دیسک تغییر دهد و آن را به کاربران توزیع کند.
- هیچ مکانیسم قفل‌گشایی موجود نیست که از حملات نیروی تبریزی جلوگیری کند.

## توکن‌های Bootstrap {#bootstrap-tokens}

توکن‌های Bootstrap برای پیوستن به کلاسترها استفاده می‌شوند و به دلایل زیر برای احراز هویت کاربر مناسب نیستند:

- آنها دارای عضویت‌های گروهی که به منظور استفاده عمومی مناسب نیستند و باعث احراز هویت نمی‌شوند.
- تولید دستی توکن‌های Bootstrap می‌تواند به توکن‌های ضعیف منجر شود که توسط حملات کننده قابل حدس زدن باشد که می‌تواند یک خطر امنیتی باشد.
- هیچ مکانیسم قفل‌گشایی موجود نیست که از حملات نیروی تبریزی جلوگیری کند و برای حدس زدن یا شکستن توکن‌ها آسان‌تر می‌شود.

## توکن‌های رمزنگاری حساب سرویس {#serviceaccount-secret-tokens}

اعتبارهای حساب سرویس موجود به عنوان یک گزینه برای اجازه به برنامه‌های در حال اجرای در کلاستر برای احراز هویت به سرور API می‌باشد. در Kubernetes < 1.23، این‌ها گزینه پیش‌فرض بوده‌اند، با این حال با توکن‌های API درخواست تعویض شده‌اند. اگرچه این اسرار می‌تواند برای احراز هویت کاربر استفاده شوند، به طور کلی برای چند دلیل مناسب نیستند:

- نمی‌توانند با انقضای تنظیم شوند و تا زمانی که حساب سرویس مرتبط حذف نشده باقی می‌مانند.
- توکن‌های احراز هویت قابل مشاهده برای هر کاربر کلاستری که می‌توانند اسرار را در فضای نامی که در آن تعریف شده‌اند بخوانند.
- حساب‌های سرویس نمی‌توانند به گروه‌های دلخواه اضافه شوند که مدیریت RBAC را در موارد استفاده شده دشوار می‌کند.

## توکن‌های API درخواست {#tokenrequest-api-tokens}

API توکن‌درخواست ابزار مفیدی برای تولید اعتبارهای کوتاه مدت برای احراز هویت سرویس به سرور API یا سیستم‌های شخص ثالث است. با این حال، به طور کلی برای احراز هویت کاربر توصیه نمی‌شود زیرا روشی برای ابطال مجدد وجود ندارد و توزیع اعتبارها به کاربران به صورت امن چالشی است.

هنگام استفاده از توکن‌های API درخواست برای احراز هویت سرویس، توصیه می‌شود که عمر کوتاه تری برای کاهش تأثیر توکن‌های دسترسی آسیب‌پذیر تنظیم شود.

## احراز هویت با توکن‌های OpenID Connect {#openid-connect-token-authentication}

Kubernetes از ادغام خدمات احراز هویت خارجی با API Kubernetes با استفاده از [OpenID Connect (OIDC)](/docs/reference/access-authn-authz/authentication/#openid-connect-tokens) پشتیبانی می‌کند. برای استفاده از احراز هویت OIDC برای Kubernetes، مهم است بررسی تدابیر تقویتی زیر را در نظر بگیرید:

- نرم‌افزار نصب شده در کلاستر برای پشتیبانی از احراز هویت OIDC باید از بارهای کاری عمومی جدا باشد زیرا با امتیازات بالا اجرا می‌شود.
- برخی خدمات مدیریت شده Kubernetes محدودیت‌هایی در ارائه‌دهندگان OIDC قابل استفاده دارند.
- همانطور که با توکن‌های API درخواست، توصیه می‌شود که توکن‌های OIDC دارای عمر کوتاه باشند تا تأثیر توکن‌های دسترسی آسیب‌پذیر را کاهش دهند.

## احراز هویت با توکن‌های Webhook {#webhook-token-authentication}

احراز هویت با توکن‌های Webhook [Webhook token authentication](/docs/reference/access-authn-authz/authentication/#webhook-token-authentication) یک گزینه دیگر برای ادغام ارائه دهندگان احراز هویت خارجی به Kubernetes است. این مکانیسم به یک خدمت احراز هویت، که بیرون از کلاستر یا درون آن اجرا می‌شود، اجازه می‌دهد تا تصمیم احراز هویت برای یک webhook ارسال شود. مهم است به این نکته توجه داشت که مطلوبیت این مکانیسم احتمالاً به نرم‌افزار مورد استفاده برای خدمت احراز هویت بستگی دارد و برخی ملاحظات خاص Kubernetes را باید مورد بررسی قرار دهید.

برای پیکربندی احراز هویت Webhook، دسترسی به سیستم‌های فایل سرور صفحه کنترل مورد نیاز است. این بدان معنی است که با Kubernetes مدیریت شده امکان پذیر نخواهد بود مگر اینکه ارائه‌دهنده به طور خاص آن را در دسترس قرار دهد. به علاوه، هر نرم‌افزار نصب شده در کلاستر برای پشتیبانی از این دسترسی باید از بارهای کاری عمومی جدا باشد زیرا با امتیازات بالا اجرا می‌شود.

## پروکسی احراز هویت کننده {#authenticating-proxy}

یک گزینه دیگر برای ادغام سیستم‌های احراز هویت خارجی به Kubernetes استفاده از [پروکسی احراز هویت کننده](/docs/reference/access-authn-authz/authentication/#authenticating-proxy) است. در این مکانیسم، Kubernetes انتظار دارد که درخواست‌ها را از پروکسی با مقادیر هدر خاصی که برای اهداف مجوز دسترسی تنظیم شده است، دریافت کند. مهم است به این نکته توجه داشت که برای استفاده از این مکانیسم برخی ملاحظات خاص را در نظر بگیرید.

اولاً، باید از TLS به صورت امن بین پروکسی و سرور API Kubernetes استفاده شود تا خطرات انتقال ترافیک یا حملات اسنایفینگ را کاهش دهد. این اطمینان می‌دهد که ارتباط بین پروکسی و سرور API Kubernetes امن است.

دوماً، مهم است به یاد داشته باشید که یک حمله‌کننده که قادر به اصلاح هدرهای درخواست باشد، ممکن است به دسترسی غیرمجاز به منابع Kubernetes برسد. بنابراین، مهم است اطمینان حاصل شود که هدرها به درستی امن شده و قابل تغییر نیستند.
