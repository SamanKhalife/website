---
reviewers:
- tallclair
- liggitt
title: کنترل کننده تایید امنیت پاد
description: >
  مروری بر کنترل کننده تایید امنیت پاد که می‌تواند استانداردهای امنیت پاد را اعمال کند.
content_type: concept
weight: 20
---

<!-- مرور -->

{{< feature-state for_k8s_version="v1.25" state="stable" >}}

[استانداردهای امنیت پاد Kubernetes](/docs/concepts/security/pod-security-standards/) سطوح جداسازی مختلفی را برای پادها تعریف می‌کنند. این استانداردها به شما این امکان را می‌دهند که به چه صورتی می‌خواهید رفتار پادها را با قوانین واضح و سازمان‌یافته محدود کنید.

کوبرنتیز دارای یک _کنترل کننده تایید امنیت پاد_ {{< glossary_tooltip text="admission controller" term_id="admission-controller" >}} داخلی است که به اعمال استانداردهای امنیت پاد کمک می‌کند. محدودیت‌های امنیت پاد در سطح فضای نام اعمال می‌شوند هنگامی که پادها ایجاد می‌شوند.

### اعمال اجباری امنیت پاد داخلی

این صفحه بخشی از مستندات Kubernetes v{{< skew currentVersion >}} است. اگر نسخه دیگری از Kubernetes را اجرا می‌کنید، به مستندات آن نسخه مراجعه کنید.

<!-- متن -->

## سطوح امنیت پاد

کنترل امنیت پاد نیازمندی‌هایی را بر روی [سیاق امنیتی](/docs/tasks/configure-pod-container/security-context/) پاد و دیگر فیلدهای مرتبط به سه سطح تعریف شده توسط [استانداردهای امنیت پاد](/docs/concepts/security/pod-security-standards) اعمال می‌کند: `privileged`، `baseline` و `restricted`. برای کسب اطلاعات بیشتر، به صفحه [استانداردهای امنیت پاد](/docs/concepts/security/pod-security-standards) مراجعه کنید.

## برچسب‌های تایید امنیت پاد برای فضاهای نام

پس از فعال‌سازی وب‌هوک، می‌توانید فضاهای نام را پیکربندی کنید تا حالت کنترل تایید امنیت را که می‌خواهید برای امنیت پاد در هر فضای نام استفاده کنید، تعریف کنید. کوبرنتیز مجموعه‌ای از {{< glossary_tooltip term_id="label" text="labels" >}} تعریف کرده است که می‌توانید برای تعریف کدام یک از سطوح استاندارد امنیت پاد پیش‌تعریف شده می‌خواهید در یک فضای نام استفاده کنید. برچسبی که انتخاب می‌کنید، تعریف می‌کند که کنترل تایید امنیت پاد چه عملیاتی را در صورت تشخیص یک نقض پتانسیلی انجام می‌دهد:

{{< table caption="حالت‌های کنترل تایید امنیت پاد" >}}
حالت | توضیحات
:---------|:------------
**enforce** | نقض‌های سیاستی باعث رد شدن پاد می‌شود.
**audit** | نقض‌های سیاستی باعث افزودن یک یادداشت حسابرسی به رویداد ثبت شده در [گزارش حسابرسی](/docs/tasks/debug/debug-cluster/audit/) می‌شوند، اما در غیر این صورت مجاز هستند.
**warn** | نقض‌های سیاستی باعث هشدار مواجه با کاربر می‌شوند، اما در غیر این صورت مجاز هستند.
{{< /table >}}

یک فضای نام می‌تواند هر یک یا تمام حالت‌ها را پیکربندی کند، یا حتی برای حالت‌های مختلف سطح متفاوتی تعریف کند.

برای هر حالت، دو برچسب وجود دارد که سیاست استفاده شده را تعیین می‌کند:

```yaml
# برچسب سطح به سطح افراد گوارد را تعیین کند که برای حالت مشخص می‌شود.
#
# حالت باید یکی از `enforce`، `audit` یا `warn` باشد.
# سطح باید یکی از `privileged`، `baseline` یا `restricted` باشد.
pod-security.kubernetes.io/<MODE>: <LEVEL>

# اختیاری: برچسب سطح نسخه که می‌تواند برای سیاست از تقاوتی که به یک Kubernetes باید برای ارائه نسخه داده شود (مثلا v{{< skew currentVersion >}}).
#
# حالت باید یکی از `enforce`، `audit` یا `warn` باشد.
# ورژن باید یک Kubernetes کوچک داده شده است و یا `آخرین`.
pod-security.kubernetes.io/<MODE>-version: <VERSION>
```

[برای مشاهده استفاده مثال، به برچسب‌های فضای نام استاندارد امنیت پاد بازدید کنید.](/docs/tasks/configure-pod-container/enforce-standards-namespace-labels)

## منابع بار و قالب پاد کاری

پادها به طور معمول به غیرمستقیم ایجاد می‌شوند، با ایجاد یک [منبع کار](/docs/concepts/workloads/controllers/) مانند یک {{< glossary_tooltip term_id="deployment" >}} یا {{< glossary_tooltip term_id="job">}}. شی محموله الگوی _پاد_ و {{< glossary_tooltip term_id="controller" text="controller" >}} برای منبع کاری تعریف می‌کند که منابع پاد بر اساس آن الگو ایجاد می‌کند. برای کمک به گرفتن خ

طاها به صورت زودهنگام، هر دو حالت حسابرسی و هشدار برای منابع بار اعمال می‌شوند. با این حال، حالت اجباری **نه** به منابع بار اعمال می‌شود، تنها به شی‌های پاد حاصل.

## مستثنیات

می‌توانید _مستثنیات_ را از اعمال اجباری امنیت پاد تعریف کنید تا ایجاد پادهایی که در غیر این صورت به دلیل سیاست مرتبط با یک فضای نام ممنوع شده بودند، مجاز باشد. مستثنیات می‌توانند به صورت ثابت در پیکربندی [کنترل کننده تایید امنیت](/docs/tasks/configure-pod-container/enforce-standards-admission-controller/#configure-the-admission-controller) تعریف شوند.

مستثنیات باید به صورت صریح برشمرده شوند. درخواست‌هایی که شرایط مستثنی را برآورده کنند، توسط کنترل کننده تایید نادیده گرفته می‌شوند (همه عملیات `enforce`، `audit` و `warn` را کنترل می‌کند). ابعاد مستثنی شامل موارد زیر است:

- **نام‌کاربری‌ها:** درخواست‌های از کاربران با نام کاربری معاف شده (یا برانگیخته) نادیده گرفته می‌شوند.
- **RuntimeClassNames:** پادها و [منابع بار](#workload-resources-and-pod-templates) نام‌کاربردی که نام کلاس اجرای معاف شده را مشخص می‌کنند، نادیده گرفته می‌شوند.
- **فضاهای نام:** پادها و [منابع بار](#workload-resources-and-pod-templates) در یک فضای نام معاف نادیده گرفته می‌شوند.

{{< caution >}}

بیشتر پادها به وسیله‌ی یک کنترلر به پاسخ به یک [منبع کار](#workload-resources-and-pod-templates) ایجاد می‌شوند، به این معنی که معافیت یک کاربر پایانی فقط آنها را از اعمال در هنگام ایجاد پاد مستقیم، اما نه هنگام ایجاد منبع کاری معاف می‌کند. حساب‌های خدمت کننده کنترلر (مانند `system:serviceaccount:kube-system:replicaset-controller`) به طور کلی معاف نمی‌شوند، زیرا این کار به طور ضمنی هر کاربری که می‌تواند منبع کار متناظر را ایجاد کند، معاف شده است.

{{< /caution >}}

به‌روزرسانی‌ها به فیلدهای پاد زیر از چک‌های سیاستی مستثنا شده‌اند، به این معنی که اگر یک درخواست به‌روزرسانی پاد تنها این فیلدها را تغییر دهد، حتی اگر پاد در تقاضای کنونی نقض سطح سیاستی باشد، رد نخواهد شد:

- هر به‌روزرسانی فیلدهای metadata **به جز** تغییرات در آنوتاسیون‌های seccomp یا AppArmor:
  - `seccomp.security.alpha.kubernetes.io/pod` (منسوخ شده)
  - `container.seccomp.security.alpha.kubernetes.io/*` (منسوخ شده)
  - `container.apparmor.security.beta.kubernetes.io/*` (منسوخ شده)
- به‌روزرسانی‌های معتبر در `.spec.activeDeadlineSeconds`
- به‌روزرسانی‌های معتبر در `.spec.tolerations`

## معیارها

در اینجا معیارهای Prometheus توسط kube-apiserver ارائه شده است:

- `pod_security_errors_total`: این معیار تعداد خطاهایی را که باعث ارزیابی معمول نمی‌شود نشان می‌دهد. خطاهای غیرمهلک ممکن است منجر به استفاده از آخرین پروفایل محدود شده برای اجرا شوند.
- `pod_security_evaluations_total`: این معیار تعداد ارزیابی‌های سیاستی که انجام شده است را نشان می‌دهد، بدون محاسبه درخواست‌های نادیده گرفته شده یا مستثنی.
- `pod_security_exemptions_total`: این معیار تعداد درخواست‌های مستثنی را نشان می‌دهد، بدون محاسبه درخواست‌های نادیده گرفته شده یا خارج از دام.

## {{% heading "چه‌ها" %}}

- [استانداردهای امنیت پاد](/docs/concepts/security/pod-security-standards)
- [اعمال استانداردهای امنیت پاد](/docs/setup/best-practices/enforcing-pod-security-standards)
- [اعمال استانداردهای امنیت پاد با پیکربندی کنترل کننده تایید امنیت داخلی](/docs/tasks/configure-pod-container/enforce-standards-admission-controller)
- [اعمال استانداردهای امنیت پاد با برچسب‌های فضای نام](/docs/tasks/configure-pod-container/enforce-standards-namespace-labels)

اگر نسخه‌ی قدیمی‌تری از Kubernetes را اجرا می‌کنید و می‌خواهید به یک نسخه از Kubernetes ارتقا دهید که شامل پادSecurityPolicies نباشد، [مهاجرت از PodSecurityPolicy به کنترل کننده تایید امنیت پاد داخلی](/docs/tasks/configure-pod-container/migrate-from-psp) را بخوانید.
