---
title: معیارهای متریک برای اجزای سیستم Kubernetes
reviewers:
- brancz
- logicalhan
- RainbowMango
content_type: concept
weight: 70
---

<!-- مرور -->

متریک‌های اجزای سیستم می‌توانند بهترین نگاهی به آنچه در داخل آنها اتفاق می‌افتد را ارائه دهند. متریک‌ها به ویژه برای ساخت داشبوردها و هشدارها بسیار مفید هستند.

اجزای Kubernetes متریک‌ها را به [فرمت Prometheus](https://prometheus.io/docs/instrumenting/exposition_formats/) منتشر می‌کنند. این فرمت متن ساختارمند است که برای اینکه هم انسان‌ها و هم ماشین‌ها بتوانند آن را بخوانند، طراحی شده است.

<!-- بدنه -->

## متریک‌ها در Kubernetes

در اکثر موارد، متریک‌ها در آدرس `/metrics` از سرور HTTP در دسترس هستند. برای اجزا که به طور پیش‌فرض این آدرس را منتشر نمی‌کنند، می‌توان از پرچم `--bind-address` استفاده کرد.

نمونه‌هایی از این اجزا عبارتند از:

- {{< glossary_tooltip term_id="kube-controller-manager" text="kube-controller-manager" >}}
- {{< glossary_tooltip term_id="kube-proxy" text="kube-proxy" >}}
- {{< glossary_tooltip term_id="kube-apiserver" text="kube-apiserver" >}}
- {{< glossary_tooltip term_id="kube-scheduler" text="kube-scheduler" >}}
- {{< glossary_tooltip term_id="kubelet" text="kubelet" >}}

در محیط تولید، ممکن است بخواهید سرور Prometheus یا یک ابزار معادل متریک‌ها را به طور دوره‌ای جمع‌آوری کنید و آن‌ها را در پایگاه داده‌های سری زمانی قابل دسترس قرار دهید.

لطفا توجه داشته باشید که {{< glossary_tooltip term_id="kubelet" text="kubelet" >}} نیز متریک‌ها را در آدرس‌های `/metrics/cadvisor`، `/metrics/resource` و `/metrics/probes` منتشر می‌کند. این متریک‌ها همان دوره عمر مشترکی را ندارند.

اگر خوشه شما از {{< glossary_tooltip term_id="rbac" text="RBAC" >}} استفاده می‌کند، خواندن متریک‌ها نیازمند مجوز است که از طریق یک کاربر، گروه یا ServiceAccount با ClusterRole که اجازه دسترسی به `/metrics` را دارد، ممکن است. به عنوان مثال:

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: prometheus
rules:
  - nonResourceURLs:
      - "/metrics"
    verbs:
      - get
```

## عمر متریک

متریک‌های آلفا → متریک‌های استون → متریک‌های منسوخ → متریک‌های پنهان → متریک‌های حذف‌شده

متریک‌های آلفا گارانتی پایداری ندارند. این متریک‌ها ممکن است هر زمانی تغییر یا حذف شوند.

متریک‌های استون تضمین شده‌اند که تغییر نخواهند کرد. این به این معنی است:

- متریک استون بدون امضا منسوخ نمی‌شود یا تغییر نام نمی‌دهد.
- نوع متریک استون تغییر نمی‌کند.

متریک‌های منسوخ برای حذف برنامه‌ریزی شده‌اند، اما هنوز برای استفاده در دسترس هستند. این متریک‌ها شامل یک حاشیه‌نویس درباره نسخه‌ای است که در آن منسوخ شده‌اند.

برای مثال:

- قبل از منسوخ شدن

  ```
  # HELP some_counter this counts things
  # TYPE some_counter counter
  some_counter 0
  ```

- بعد از منسوخ شدن

  ```
  # HELP some_counter (منسوخ شده از نسخه 1.15.0) this counts things
  # TYPE some_counter counter
  some_counter 0
  ```

متریک‌های پنهان دیگر برای اسکرپینگ منتشر نمی‌شوند، اما هنوز برای استفاده در دسترس هستند. برای استفاده از یک متریک پنهان، لطفا به بخش [نمایش متریک‌های پنهان](#show-hidden-metrics) مراجعه کنید.

متریک‌های حذف‌شده دیگر منتشر نمی‌شوند و نمی‌توان از آنها استفاده کرد.

## نمایش متریک‌های پنهان

همانطور که در بالا توضیح داده شد، مدیران می‌توانند متریک‌های پنهان را از طریق پرچم خط فرمان در یک باینری خاص فعال کنند. این به عنوان یک راه‌حل اضطراری برای مدیران استفاده می‌شود اگر از مهاجرت متریک‌هایی که در اخرین انتشار منسوخ شده‌اند، گذر کرده‌اند.

پرچم `show-hidden-metrics-for-version` یک نسخه را می‌پذیرد که می‌خواهید متریک‌های منسوخ شده در آن انتشار را نمایش دهید. نسخه به عنوان x.y بیان می‌شود، جایی که x نسخه اصلی و y نسخه فرعی است. نیازی به نسخه چرخه نمی‌شود حتی اگر یک متریک‌ها در یک انتشار چرخه نمی‌توانند به یک متریک‌ها چرخه متریک‌های امنیت متری

ک‌ها متریک‌های متریک‌ها.

پرچم می‌تواند فقط از نسخه قبلی فرعی به عنوان مقدار استفاده شود. همه متریک‌های پنهان در قبلی می‌توانند به صورت خودکار اگر مدیران تنظیمات را در `show-hidden-metrics-for-version` گذارند. این که این محدودیت‌ها بر مخارج می‌گذارد برای خدمات که این قدرت امنیت نامه‌ها خدماتی به فرمان-خط دینامیک و کارتگیر برچسب متریک‌ها چند متریک‌ها به اجازه‌دهند تنظیمات برچسب متریک‌ها خود را می‌توان از این طریق فرآیند تنظیمات که برای آنها نام را در یک نمونه تکنولوژی تجهیزات اطلاعات برابر با متریک‌های دستگاه دیگر تنظیمات برای گزینه‌ها زودتر و یا شما یا خود که دوباره بخش متن هر یک از تنظیمات برچسب متریک‌ها را که تغییرات فعالیت‌ها.

## متریک‌های اجزا

### متریک‌های kube-controller-manager

متریک‌های مدیر کنترل کننده، دیدگاه‌های مهمی را به عملکرد و سلامت مدیر کنترل کننده ارائه می‌دهند. این متریک‌ها شامل دیدگاه‌های عمومی زبان Go مانند تعداد go_routine و متریک‌های خاص کنترل کننده مانند زمان‌های تأخیر درخواست etcd یا Cloudprovider (AWS، GCE، OpenStack) API هستند که می‌تواند برای اندازه‌گیری سلامت یک خوشه استفاده شود.

از Kubernetes 1.7 به بعد، متریک‌های مفصل Cloudprovider برای عملیات ذخیره‌سازی برای GCE، AWS، Vsphere و OpenStack در دسترس هستند. این متریک‌ها می‌توانند برای نظارت بر عملیات حجم داده‌های مستمر استفاده شوند.

برای مثال، برای GCE، این متریک‌ها به نامهای زیر نامیده می‌شوند:

```
cloudprovider_gce_api_request_duration_seconds { request = "instance_list"}
cloudprovider_gce_api_request_duration_seconds { request = "disk_insert"}
cloudprovider_gce_api_request_duration_seconds { request = "disk_delete"}
cloudprovider_gce_api_request_duration_seconds { request = "attach_disk"}
cloudprovider_gce_api_request_duration_seconds { request = "detach_disk"}
cloudprovider_gce_api_request_duration_seconds { request = "list_disk"}
```


### متریک‌های kube-scheduler

{{< feature-state for_k8s_version="v1.21" state="beta" >}}

Scheduler متریک‌های اختیاری را ارائه می‌دهد که منابع درخواست‌شده و حدود دلخواه همه پاد راننده موجود را گزارش می‌دهند. این متریک‌ها می‌توانند برای ساخت داشبوردهای برنامه‌ریزی ظرفیت، ارزیابی محدودیت‌های فعلی یا تاریخی برنامه‌ریزی، شناسایی سریع کاربردها که نمی‌توانند به دلیل کمبود منابع برنامه‌ریزی شوند، و مقایسه استفاده واقعی با درخواست پاد.

Scheduler پاد اعلام می‌کند [درخواست‌ها و حدود](/docs/concepts/configuration/manage-resources-containers/)
پیکربندی شده برای هر پاد؛ هنگامی که یک درخواست یا حدود غیر صفر است، scheduler متریک‌های سری زمانی گزارش می‌دهد. سری زمانی با برچسب:

- فضای نام
- نام پاد
- گره که پاد را برنامه‌ریزی می‌کند یا یک رشته خالی اگر هنوز برنامه‌ریزی نشده باشد
- اولویت
- برنامه‌ریز اختصاص یافته برای آن پاد
- نام منبع (مانند `cpu`)
- واحد منبع اگر معلوم است (مانند `cores`)

هنگامی که یک پاد به اتمام می‌رسد (دارای `restartPolicy` از `Never` یا `OnFailure` و در فاز پاد `Succeeded` یا `Failed` است، یا حذف شده و همه ظروف حالت خاتمه‌یافته دارد) سری‌ها دیگر گزارش نمی‌دهند زیرا scheduler اکنون آزاد است که پاد‌های دیگری را برای اجرا برنامه‌ریزی کند. دو متریک به نام‌های `kube_pod_resource_request` و `kube_pod_resource_limit` نامیده می‌شوند.

متریک‌ها در آدرس HTTP `/metrics/resources` منتشر می‌شوند و نیازمند همان اجازه به عنوان آدرس `/metrics` در scheduler هستند. شما باید از پرچم `--show-hidden-metrics-for-version=1.20` استفاده کنید تا این متریک‌های پایداری آلفا را نمایش دهید.

## غیرفعال‌سازی متریک‌ها

می‌توانید به صورت صریح متریک‌ها را از طریق پرچم خط فرمان `--disabled-metrics` غیرفعال کنید. این ممکن است در صورتی که به عنوان مثال یک متریک که مشکلی در عملکرد ایجاد می‌کند، مطلوب باشد. ورودی فهرستی از متریک‌های غیرفعال (یعنی `--disabled-metrics=metric1,metric2`) است.

## اجبار ارزش برچ

سب متریک‌ها

متریک‌های با ابعاد بدون محدودیت ممکن است مشکلات حافظه را در کامپوننت‌هایی که آنها ابزار را ارائه می‌دهند. برای محدود کردن استفاده از منابع، می‌توانید از گزینه خط فرمان `--allow-label-value` برای پیکربندی پویا کردن یک انتخابه فهرست از اجازه برچسب برای یک متریک استفاده کنید.

در مرحله آلفا، پرچم فقط می‌تواند به صورت یک سری نگاشت به عنوان مجازات برچسب برچسب‌هایی بگیرد که هرکدام از فرمت `<metric_name>,<label_name>=<allowed_labels>` که 
`<allowed_labels>` فهرست جدا شده توسط کارتگیر برچسب‌های مجاز است.

فرمت کلی مانند است:

```
--allow-label-value <metric_name>,<label_name>='<allow_value1>, <allow_value2>...', <metric_name2>,<label_name>='<allow_value1>, <allow_value2>...', ...
```

اینجا یک مثال است:

```none
--allow-label-value number_count_metric,odd_number='1,3,5', number_count_metric,even_number='2,4,6', date_gauge_metric,weekend='Saturday,Sunday'
```

علاوه بر این که این از CLI مشخص شده، این همچنین می‌تواند از طریق یک پرونده پیکربندی انجام شود. شما می‌توانید مسیر این پرونده پیکربندی را با استفاده از پارامتر خط فرمان `--allow-metric-labels-manifest` به یک مؤلفه مشخص کنید. در اینجا یک مثال از محتویات آن پرونده پیکربندی است:

```yaml
allow-list:
- "metric1,label2": "v1,v2,v3"
- "metric2,label1": "v1,v2,v3"
```

علاوه بر این، متریک‌های کلیت-حاوی عملیات غیرمنتظره را برای اجرا در اثر مجازیت ها تماس می‌گیرد، که هرگاه یک برچسب ارزشی با احترام به توقعات محدود کنندگان مشتی شود.

## {{% heading "whatsnext" %}}

* خواندن درباره [فرمت متنی Prometheus](https://github.com/prometheus/docs/blob/master/content/docs/instrumenting/exposition_formats.md#text-based-format)
برای متریک‌ها
* لیست متریک‌های پایدار Kubernetes را ببینید
* در مورد [سیاست قدیمی Kubernetes](/docs/reference/using-api/deprecation-policy/#deprecating-a-feature-or-behavior)