---
reviewers:
- derekwaynecarr
title: محدودیت‌ها و رزروهای شناسه‌های فرایند
content_type: concept
weight: 40
---

<!-- overview -->

{{< feature-state for_k8s_version="v1.20" state="stable" >}}

Kubernetes امکان محدود کردن تعداد شناسه‌های فرایند (PIDs) که یک 
{{< glossary_tooltip term_id="Pod" text="Pod" >}} 
می‌تواند استفاده کند را فراهم می‌کند. همچنین می‌توانید تعدادی از PIDs‌های قابل تخصیص را برای هر 
{{< glossary_tooltip term_id="node" text="node" >}} 
برای استفاده توسط سیستم عامل و دمون‌ها (به جای Pods) رزرو کنید.

<!-- body -->

شناسه‌های فرایند (PIDs) یک منبع اساسی در گره‌ها هستند. به راحتی ممکن است حد تعداد کار انجام‌شده
در یک سیستم بدون زدن هر محدودیت منبع دیگری را بزرگ‌تر کند که می‌تواند به بدون پایداری در یک ماشین میزبان منجر شود.

مدیران خوشه نیاز به مکانیسم‌هایی دارند تا اطمینان حاصل کنند که Podsی که در خوشه اجرا می‌شوند، نمی‌توانند خروجی PIDs‌ را ایجاد کنند که مانع از اجرای دمون‌های میزبان مانند
{{< glossary_tooltip text="kubelet" term_id="kubelet" >}} 
یا 
{{< glossary_tooltip text="kube-proxy" term_id="kube-proxy" >}} 
و احتمالاً هم‌چنین سیستم اجرای کانتینر شود.
علاوه بر این، اهمیت دارد که تضمین شود که PIDs بین Pods در یک گره محدود شده‌اند تا مطمئن شوید که تأثیر محدودیت‌های موجود بر بار کاری‌های دیگر در همان گره نیز محدود شود.

{{< note >}}
در برخی نصب‌های Linux، سیستم عامل حداکثر PIDs را به یک پیش‌فرض کم تنظیم می‌کند، مانند `32768`. در نظر بگیرید که مقدار `/proc/sys/kernel/pid_max` را افزایش دهید.
{{< /note >}}

شما می‌توانید یک kubelet را تنظیم کنید تا تعداد PIDs که یک Pod داده شده می‌تواند مصرف کند را محدود کند.
برای مثال، اگر سیستم عامل میزبان شما برای استفاده از حداکثر `262144` PIDs تنظیم شده باشد و انتظار داشته باشید که کمتر از `250` Pods را میزبانی کنید، می‌توانید به هر Pod بودجه‌ای از `1000` PIDs دهید تا از استفاده از کل تعداد PIDs در دسترس این گره جلوگیری کنید. اگر مدیریت می‌خواهید تا PIDs مشابه CPU یا حافظه بالا بر سرش توزیع کند، می‌تواند همچنین با برخی مخاطرات اضافی انجام دهد. به هر حال، یک Pod تنها قادر به بر همه کردن یک ماشین نخواهد بود. این نوع محدودیت منابع به جلوگیری از اثرات منفی بمب‌های fork بر روی عملکرد کل خوشه کمک می‌کند.

محدودیت PIDs برای هر Pod اجازه می‌دهد که مدیران از یکدیگر محافظت کنند، اما این مطمئن نیست که تمام Podsی که بر روی همان گره زمان‌بندی شده‌اند، قادر به تأثیر گذاری بر گره به طور کلی هستند.
محدودیت PIDs همچنین از دمون‌های گره خودشان از فرسایش PIDs محافظت نمی‌کند.

همچنین می‌توانید مقداری از PIDs را برای هدره‌های گره رزرو کنید، جدا از تخصیص به Pods. این مشابه این است که شما می‌توانید CPU، حافظه یا دیگر منابع را برای استفاده توسط سیستم عامل و دیگر امکانات خارج از Pods و کانتینرهای آن‌ها رزرو کنید.

محدودیت PIDs خواهر مهمی برای 
[درخواست و محدودیت منابع محاسباتی](/docs/concepts/configuration/manage-resources-containers/) 
است. با این حال، شما آن را به یک روش متفاوت تعریف می‌کنید: به جای تعریف محدودیت منبع Pod در `.spec` برای یک Pod خاص، شما محدودیت را به عنوان تنظیم در kubelet پیکربندی می‌کنید. محدودیت‌های تعریف شده برای Pod اکنون پشتیبانی نمی‌شود.

{{< caution >}}
این بدان معنی است که محدودیتی که به یک Pod اعمال می‌شود ممکن است به وابستگی آن بستگی داشته باشد که Pod کجا زمان بندی شده است. برای ساده‌تر کردن کارها، بهتر است که تمام گره‌ها از همان محدودیت‌ها و رزروهای منابع PID استفاده کنند.
{{< /caution >}}

## محدودیت‌های PID گره

Kubernetes به شما امکان می‌دهد تا تعدادی از شناسه‌های فرایند را برای استفاده سیستم رزرو کنید. برای پیکربندی این رزرو، از پارامتر `pid=<number>` در خط فرمان `--system-reserved` و `--kube-reserved` در kubelet استفاده کنید. مقداری که تعیین می‌کنید اعلام می‌کند که تعداد خاصی از شناسه‌های فرایند به صورت کلی برای سیستم و برای دیمون‌های سیستم Kubernetes رزرو شده است.

## محدودیت‌های PID Pods

Kubernetes به شما امکان می‌دهد تا تعداد فرایندهای در حال اجرا در یک Pod را محدود کنید. شما این محدودیت را در سطح گره تنظیم می‌کنید، به جای پیکربندی آن به عنوان یک محدودیت منبع برای یک Pod خاص. هر گره می‌تواند یک محدودیت PID متفاوت داشته باشد.
برای پیکربندی این محدودیت، می‌توانید پارامتر خط فرمان `--pod-max-pids` را به kubelet تعیین کنید، یا `PodPidsLimit` را در فایل پیکربندی kubelet
[پیکربندی](/docs/tasks/administer-cluster/kubelet-config-file/)
تعیین کنید.

## خروج از محدودیت PID مبنی بر شناسه

شما می‌توانید kubelet را پیکربندی کنید تا شروع به اخراج یک Pod کند که هنگامی که این امکان وجود دارد که مصرف منابعی نامعقول را مصرف کند.
این ویژگی به نام اخراج خودکار است. شما می‌توانید
[پیکربندی تحمل خارج از منابع](/docs/concepts/scheduling-eviction/node-pressure-eviction/)
برای اخراج سیگنال‌های مختلف اخراج را پیکربندی کنید.
استفاده از اخراج `pid.available` برای تنظیم حداقل تعداد PIDs استفاده شده توسط Pod.
شما می‌توانید سیاست‌های تخریب نرم و سخت را تنظیم کنید.
با این حال، حتی با سیاست تخریب سخت، اگر تعداد PIDs به سرعت بالا برود،
گره هنوز می‌تواند وضعیت نامناسبی را با ضربه‌زدن به حد محدود PIDs به وجود آورد.
مقدار سیگنال تخریب به صورت دوره‌ای محاسبه می‌شود و محدودیت را اجرا نمی‌کند.

محدودیت PIDs - برای هر Pod و گره - حد سخت را تعیین می‌کند.
هنگامی که حد تعداد به حدود می‌رسد، بار کاری هنگام تلاش برای دریافت یک PID جدید با شکست روبرو خواهد شد.
ممکن است یا نمی‌تواند بازنشانی یک Pod را انجام دهد،
بسته به اینکه چگونه بار کاری در برابر این خرابی‌ها عمل کرده و چگونه تست‌های زندگی و آمادگی برای Pod پیکربندی شده‌اند. با این حال، اگر محدودیت‌ها به درستی تنظیم شده باشند، می‌توانید تضمین کنید که کارهای دیگر Pods و فرایندهای سیستم اجرا نمی‌شوند.
وقتی یک Pod به نحوی خراب شود.
## {{% heading "whatsnext" %}}

- به [سند افزایش محدودیت PIDs](https://github.com/kubernetes/enhancements/blob/097b4d8276bc9564e56adf72505d43ce9bc5e9e8/keps/sig-node/20190129-pid-limiting.md) برای اطلاعات بیشتر مراجعه کنید.
- برای سند تاریخی، به
  [محدودیت شناسه فرایند برای بهبود پایداری در Kubernetes 1.14](/blog/2019/04/15/process-id-limiting-for-stability-improvements-in-kubernetes-1.14/)
  مراجعه کنید.
- به [مدیریت منابع برای کانتینرها](/docs/concepts/configuration/manage-resources-containers/)
  مراجعه کنید.
- یاد بگیرید که چگونه
  [پیکربندی مدیریت خارج از منابع را برای](/docs/concepts/scheduling-eviction/node-pressure-eviction/)
  برخی سیگنال‌های اخراج تنظیم کنید.